/**
 * Joint 0.4 - JavaScript diagramming library.
 * Copyright (c) David Durman 2009 - 2011
 * Licensed under the MIT license: (http://www.opensource.org/licenses/mit-license.php)
 */Raphael=function(){function C(a,b,d){function f(){var h=Array[B].slice.call(arguments,0),e=h[X]("\u25ba"),o=f.cache=f.cache||{},m=f.count=f.count||[];if(o[L](e))return d?d(o[e]):o[e];m[x]>=1E3&&delete o[m.shift()];m[$](e);o[e]=a[K](b,h);return d?d(o[e]):o[e]}return f}function s(){return this.x+Q+this.y}function E(a){return function(b,d,f,h){var e={back:a};u.is(f,"function")?h=f:e.rot=f;b&&b.constructor==J&&(b=b.attrs.path);b&&(e.along=b);return this.animate(e,d,h)}}var g=/[, ]+/,i=/^(circle|rect|path|ellipse|text|image)$/, j=document,r=window,w={was:"Raphael"in r,is:r.Raphael},u=function(){if(u.is(arguments[0],"array")){for(var a=arguments[0],b=Ba[K](u,a.splice(0,3+u.is(a[0],ca))),d=b.set(),f=0,h=a[x];f<h;f++){var e=a[f]||{};i.test(e.type)&&d[$](b[e.type]().attr(e))}return d}return Ba[K](u,arguments)},I=function(){},K="apply",Q=" ",Y="click dblclick mousedown mousemove mouseout mouseover mouseup".split(Q),L="hasOwnProperty",X="join",x="length",B="prototype",S=String[B].toLowerCase,M=Math,ea=M.max,ka=M.min,ca="number", sa=Object[B].toString,U=M.pow,$="push",pa=/^(?=[\da-f]$)/,wa=/^url\(['"]?([^\)]+)['"]?\)$/i,ta=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgb\(\s*([\d\.]+\s*,\s*[\d\.]+\s*,\s*[\d\.]+)\s*\)|rgb\(\s*([\d\.]+%\s*,\s*[\d\.]+%\s*,\s*[\d\.]+%)\s*\)|hs[bl]\(\s*([\d\.]+\s*,\s*[\d\.]+\s*,\s*[\d\.]+)\s*\)|hs[bl]\(\s*([\d\.]+%\s*,\s*[\d\.]+%\s*,\s*[\d\.]+%)\s*\))\s*$/i,Z=M.round,c=parseFloat,k=parseInt,p=String[B].toUpperCase,t={"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"', "font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rotation:0,rx:0,ry:0,scale:"1 1",src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",translation:"0 0",width:0,x:0,y:0},v={along:"along","clip-rect":"csv",cx:ca,cy:ca,fill:"colour","fill-opacity":ca, "font-size":ca,height:ca,opacity:ca,path:"path",r:ca,rotation:"csv",rx:ca,ry:ca,scale:"csv",stroke:"colour","stroke-opacity":ca,"stroke-width":ca,translation:"csv",width:ca,x:ca,y:ca};u.version="1.3.1";u.type=r.SVGAngle||j.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if(u.type=="VML"){var y=document.createElement("div");y.innerHTML="<\!--[if vml]><br><br><![endif]--\>";if(y.childNodes[x]!=2)return null}u.svg=!(u.vml=u.type=="VML");I[B]=u[B];u._id= 0;u._oid=0;u.fn={};u.is=function(a,b){b=S.call(b);return(b=="object"||b=="undefined")&&typeof a==b||a==null&&b=="null"||S.call(sa.call(a).slice(8,-1))==b};u.setWindow=function(a){r=a;j=r.document};var O=function(a){if(u.vml){var b=/^\s+|\s+$/g;O=C(function(f){var h;f=(f+"").replace(b,"");try{var e=new ActiveXObject("htmlfile");e.write("<body>");e.close();h=e.body}catch(o){h=createPopup().document.body}e=h.createTextRange();try{h.style.color=f;var m=e.queryCommandValue("ForeColor");return"#"+("000000"+ ((m&255)<<16|m&65280|(m&16711680)>>>16).toString(16)).slice(-6)}catch(n){return"none"}})}else{var d=j.createElement("i");d.title="Rapha\u00ebl Colour Picker";d.style.display="none";j.body.appendChild(d);O=C(function(f){d.style.color=f;return j.defaultView.getComputedStyle(d,"").getPropertyValue("color")})}return O(a)};u.hsb2rgb=C(function(a,b,d){if(u.is(a,"object")&&"h"in a&&"s"in a&&"b"in a){d=a.b;b=a.s;a=a.h}var f;if(d==0)return{r:0,g:0,b:0,hex:"#000"};if(a>1||b>1||d>1){a/=255;b/=255;d/=255}f=~~(a* 6);a=a*6-f;var h=d*(1-b),e=d*(1-b*a),o=d*(1-b*(1-a));a=[d,e,h,h,o,d,d][f];b=[o,d,d,e,h,h,o][f];f=[h,h,o,d,d,e,h][f];a*=255;b*=255;f*=255;d={r:a,g:b,b:f};a=(~~a).toString(16);b=(~~b).toString(16);f=(~~f).toString(16);a=a.replace(pa,"0");b=b.replace(pa,"0");f=f.replace(pa,"0");d.hex="#"+a+b+f;return d},u);u.rgb2hsb=C(function(a,b,d){if(u.is(a,"object")&&"r"in a&&"g"in a&&"b"in a){d=a.b;b=a.g;a=a.r}if(u.is(a,"string")){var f=u.getRGB(a);a=f.r;b=f.g;d=f.b}if(a>1||b>1||d>1){a/=255;b/=255;d/=255}f=ea(a, b,d);var h=ka(a,b,d);if(h==f)return{h:0,s:0,b:f};else{h=f-h;a=a==f?(b-d)/h:b==f?2+(d-a)/h:4+(a-b)/h;a/=6;a<0&&a++;a>1&&a--}return{h:a,s:h/f,b:f}},u);var aa=/,?([achlmqrstvxz]),?/gi;u._path2string=function(){return this.join(",").replace(aa,"$1")};u.getRGB=C(function(a){if(!a||(a+="").indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1};if(a=="none")return{r:-1,g:-1,b:-1,hex:"none"};!({hs:1,rg:1}[L](a.substring(0,2))||a.charAt()=="#")&&(a=O(a));var b,d,f,h;if(a=a.match(ta)){if(a[2]){f=k(a[2].substring(5), 16);d=k(a[2].substring(3,5),16);b=k(a[2].substring(1,3),16)}if(a[3]){f=k((h=a[3].charAt(3))+h,16);d=k((h=a[3].charAt(2))+h,16);b=k((h=a[3].charAt(1))+h,16)}if(a[4]){a=a[4].split(/\s*,\s*/);b=c(a[0]);d=c(a[1]);f=c(a[2])}if(a[5]){a=a[5].split(/\s*,\s*/);b=c(a[0])*2.55;d=c(a[1])*2.55;f=c(a[2])*2.55}if(a[6]){a=a[6].split(/\s*,\s*/);b=c(a[0]);d=c(a[1]);f=c(a[2]);return u.hsb2rgb(b,d,f)}if(a[7]){a=a[7].split(/\s*,\s*/);b=c(a[0])*2.55;d=c(a[1])*2.55;f=c(a[2])*2.55;return u.hsb2rgb(b,d,f)}a={r:b,g:d,b:f}; b=(~~b).toString(16);d=(~~d).toString(16);f=(~~f).toString(16);b=b.replace(pa,"0");d=d.replace(pa,"0");f=f.replace(pa,"0");a.hex="#"+b+d+f;return a}return{r:-1,g:-1,b:-1,hex:"none",error:1}},u);u.getColor=function(a){a=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||0.75};var b=this.hsb2rgb(a.h,a.s,a.b);a.h+=0.075;if(a.h>1){a.h=0;a.s-=0.2;a.s<=0&&(this.getColor.start={h:0,s:1,b:a.b})}return b.hex};u.getColor.reset=function(){delete this.start};u.parsePathString=C(function(a){if(!a)return null; var b={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},d=[];if(u.is(a,"array")&&u.is(a[0],"array"))d=da(a);d[x]||(a+"").replace(/([achlmqstvz])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?\s*,?\s*)+)/ig,function(f,h,e){var o=[];f=S.call(h);for(e.replace(/(-?\d*\.?\d*(?:e[-+]?\d+)?)\s*,?\s*/ig,function(m,n){n&&o[$](+n)});o[x]>=b[f];){d[$]([h].concat(o.splice(0,b[f])));if(!b[f])break}});d.toString=u._path2string;return d});u.findDotsAtSegment=function(a,b,d,f,h,e,o,m,n){var q=1-n,z=U(q,3)*a+U(q,2)*3*n*d+q*3*n*n*h+U(n, 3)*o;q=U(q,3)*b+U(q,2)*3*n*f+q*3*n*n*e+U(n,3)*m;var A=a+2*n*(d-a)+n*n*(h-2*d+a),H=b+2*n*(f-b)+n*n*(e-2*f+b),R=d+2*n*(h-d)+n*n*(o-2*h+d),F=f+2*n*(e-f)+n*n*(m-2*e+f);a=(1-n)*a+n*d;b=(1-n)*b+n*f;h=(1-n)*h+n*o;e=(1-n)*e+n*m;m=90-M.atan((A-R)/(H-F))*180/M.PI;(A>R||H<F)&&(m+=180);return{x:z,y:q,m:{x:A,y:H},n:{x:R,y:F},start:{x:a,y:b},end:{x:h,y:e},alpha:m}};var V=C(function(a){if(!a)return{x:0,y:0,width:0,height:0};a=ja(a);for(var b=0,d=0,f=[],h=[],e,o=0,m=a[x];o<m;o++){e=a[o];if(e[0]=="M"){b=e[1];d=e[2]; f[$](b);h[$](d)}else{b=na(b,d,e[1],e[2],e[3],e[4],e[5],e[6]);f=f.concat(b.min.x,b.max.x);h=h.concat(b.min.y,b.max.y);b=e[5];d=e[6]}}a=ka[K](0,f);e=ka[K](0,h);return{x:a,y:e,width:ea[K](0,f)-a,height:ea[K](0,h)-e}}),da=function(a){var b=[];if(!u.is(a,"array")||!u.is(a&&a[0],"array"))a=u.parsePathString(a);for(var d=0,f=a[x];d<f;d++){b[d]=[];for(var h=0,e=a[d][x];h<e;h++)b[d][h]=a[d][h]}b.toString=u._path2string;return b},qa=C(function(a){if(!u.is(a,"array")||!u.is(a&&a[0],"array"))a=u.parsePathString(a); var b=[],d=0,f=0,h=0,e=0,o=0;if(a[0][0]=="M"){d=a[0][1];f=a[0][2];h=d;e=f;o++;b[$](["M",d,f])}for(var m=a[x];o<m;o++){var n=b[o]=[],q=a[o];if(q[0]!=S.call(q[0])){n[0]=S.call(q[0]);switch(n[0]){case "a":n[1]=q[1];n[2]=q[2];n[3]=q[3];n[4]=q[4];n[5]=q[5];n[6]=+(q[6]-d).toFixed(3);n[7]=+(q[7]-f).toFixed(3);break;case "v":n[1]=+(q[1]-f).toFixed(3);break;case "m":h=q[1];e=q[2];default:for(var z=1,A=q[x];z<A;z++)n[z]=+(q[z]-(z%2?d:f)).toFixed(3)}}else{b[o]=[];if(q[0]=="m"){h=q[1]+d;e=q[2]+f}n=0;for(z=q[x];n< z;n++)b[o][n]=q[n]}q=b[o][x];switch(b[o][0]){case "z":d=h;f=e;break;case "h":d+=+b[o][q-1];break;case "v":f+=+b[o][q-1];break;default:d+=+b[o][q-2];f+=+b[o][q-1]}}b.toString=u._path2string;return b},0,da),ba=C(function(a){if(!u.is(a,"array")||!u.is(a&&a[0],"array"))a=u.parsePathString(a);var b=[],d=0,f=0,h=0,e=0,o=0;if(a[0][0]=="M"){d=+a[0][1];f=+a[0][2];h=d;e=f;o++;b[0]=["M",d,f]}for(var m=a[x];o<m;o++){var n=b[o]=[],q=a[o];if(q[0]!=p.call(q[0])){n[0]=p.call(q[0]);switch(n[0]){case "A":n[1]=q[1]; n[2]=q[2];n[3]=q[3];n[4]=q[4];n[5]=q[5];n[6]=+(q[6]+d);n[7]=+(q[7]+f);break;case "V":n[1]=+q[1]+f;break;case "H":n[1]=+q[1]+d;break;case "M":h=+q[1]+d;e=+q[2]+f;default:for(var z=1,A=q[x];z<A;z++)n[z]=+q[z]+(z%2?d:f)}}else{z=0;for(A=q[x];z<A;z++)b[o][z]=q[z]}switch(n[0]){case "Z":d=h;f=e;break;case "H":d=n[1];break;case "V":f=n[1];break;default:d=b[o][b[o][x]-2];f=b[o][b[o][x]-1]}}b.toString=u._path2string;return b},null,da),ha=function(a,b,d,f,h,e){var o=1/3,m=2/3;return[o*a+m*d,o*b+m*f,o*h+m*d, o*e+m*f,h,e]},ga=function(a,b,d,f,h,e,o,m,n,q){var z=M.PI,A=z*120/180,H=z/180*(+h||0),R=[],F,D=C(function(W,Ha,ya){var Ya=W*M.cos(ya)-Ha*M.sin(ya);W=W*M.sin(ya)+Ha*M.cos(ya);return{x:Ya,y:W}});if(q){N=q[0];F=q[1];e=q[2];T=q[3]}else{F=D(a,b,-H);a=F.x;b=F.y;F=D(m,n,-H);m=F.x;n=F.y;M.cos(z/180*h);M.sin(z/180*h);F=(a-m)/2;N=(b-n)/2;d=ea(d,M.abs(F));f=ea(f,M.abs(N));T=F*F/(d*d)+N*N/(f*f);if(T>1){d*=M.sqrt(T);f*=M.sqrt(T)}T=d*d;var G=f*f;T=(e==o?-1:1)*M.sqrt(M.abs((T*G-T*N*N-G*F*F)/(T*N*N+G*F*F)));e=T* d*N/f+(a+m)/2;var T=T*-f*F/d+(b+n)/2,N=M.asin(((b-T)/f).toFixed(7));F=M.asin(((n-T)/f).toFixed(7));N=a<e?z-N:N;F=m<e?z-F:F;N<0&&(N=z*2+N);F<0&&(F=z*2+F);if(o&&N>F)N-=z*2;if(!o&&F>N)F-=z*2}if(M.abs(F-N)>A){R=F;z=m;G=n;F=N+A*(o&&F>N?1:-1);m=e+d*M.cos(F);n=T+f*M.sin(F);R=ga(m,n,d,f,h,0,o,z,G,[F,R,e,T])}e=F-N;h=M.cos(N);A=M.sin(N);o=M.cos(F);z=M.sin(F);F=M.tan(e/4);d=4/3*d*F;F*=4/3*f;f=[a,b];a=[a+d*A,b-F*h];b=[m+d*z,n-F*o];m=[m,n];a[0]=2*f[0]-a[0];a[1]=2*f[1]-a[1];if(q)return[a,b,m].concat(R);else{R= [a,b,m].concat(R)[X]().split(",");q=[];m=0;for(n=R[x];m<n;m++)q[m]=m%2?D(R[m-1],R[m],H).y:D(R[m],R[m+1],H).x;return q}},la=function(a,b,d,f,h,e,o,m,n){var q=1-n;return{x:U(q,3)*a+U(q,2)*3*n*d+q*3*n*n*h+U(n,3)*o,y:U(q,3)*b+U(q,2)*3*n*f+q*3*n*n*e+U(n,3)*m}},na=C(function(a,b,d,f,h,e,o,m){var n=h-2*d+a-(o-2*h+d),q=2*(d-a)-2*(h-d),z=a-d,A=(-q+M.sqrt(q*q-4*n*z))/2/n;n=(-q-M.sqrt(q*q-4*n*z))/2/n;var H=[b,m],R=[a,o];M.abs(A)>1E12&&(A=0.5);M.abs(n)>1E12&&(n=0.5);if(A>0&&A<1){A=la(a,b,d,f,h,e,o,m,A);R[$](A.x); H[$](A.y)}if(n>0&&n<1){A=la(a,b,d,f,h,e,o,m,n);R[$](A.x);H[$](A.y)}n=e-2*f+b-(m-2*e+f);q=2*(f-b)-2*(e-f);z=b-f;A=(-q+M.sqrt(q*q-4*n*z))/2/n;n=(-q-M.sqrt(q*q-4*n*z))/2/n;M.abs(A)>1E12&&(A=0.5);M.abs(n)>1E12&&(n=0.5);if(A>0&&A<1){A=la(a,b,d,f,h,e,o,m,A);R[$](A.x);H[$](A.y)}if(n>0&&n<1){A=la(a,b,d,f,h,e,o,m,n);R[$](A.x);H[$](A.y)}return{min:{x:ka[K](0,R),y:ka[K](0,H)},max:{x:ea[K](0,R),y:ea[K](0,H)}}}),ja=C(function(a,b){var d=ba(a),f=b&&ba(b),h={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},e={x:0,y:0, bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=function(D,G){var T,N;if(!D)return["C",G.x,G.y,G.x,G.y,G.x,G.y];!(D[0]in{T:1,Q:1})&&(G.qx=G.qy=null);switch(D[0]){case "M":G.X=D[1];G.Y=D[2];break;case "A":D=["C"].concat(ga[K](0,[G.x,G.y].concat(D.slice(1))));break;case "S":T=G.x+(G.x-(G.bx||G.x));N=G.y+(G.y-(G.by||G.y));D=["C",T,N].concat(D.slice(1));break;case "T":G.qx=G.x+(G.x-(G.qx||G.x));G.qy=G.y+(G.y-(G.qy||G.y));D=["C"].concat(ha(G.x,G.y,G.qx,G.qy,D[1],D[2]));break;case "Q":G.qx=D[1];G.qy=D[2];D=["C"].concat(ha(G.x, G.y,D[1],D[2],D[3],D[4]));break;case "L":D=["C"].concat([G.x,G.y,D[1],D[2],D[1],D[2]]);break;case "H":D=["C"].concat([G.x,G.y,D[1],G.y,D[1],G.y]);break;case "V":D=["C"].concat([G.x,G.y,G.x,D[1],G.x,D[1]]);break;case "Z":D=["C"].concat([G.x,G.y,G.X,G.Y,G.X,G.Y])}return D},m=function(D,G){if(D[G][x]>7){D[G].shift();for(var T=D[G];T[x];)D.splice(G++,0,["C"].concat(T.splice(0,6)));D.splice(G,1);z=ea(d[x],f&&f[x]||0)}},n=function(D,G,T,N,W){if(D&&G&&D[W][0]=="M"&&G[W][0]!="M"){G.splice(W,0,["M",N.x,N.y]); T.bx=0;T.by=0;T.x=D[W][1];T.y=D[W][2];z=ea(d[x],f&&f[x]||0)}},q=0,z=ea(d[x],f&&f[x]||0);for(;q<z;q++){d[q]=o(d[q],h);m(d,q);f&&(f[q]=o(f[q],e));f&&m(f,q);n(d,f,h,e,q);n(f,d,e,h,q);var A=d[q],H=f&&f[q],R=A[x],F=f&&H[x];h.x=A[R-2];h.y=A[R-1];h.bx=c(A[R-4])||h.x;h.by=c(A[R-3])||h.y;e.bx=f&&(c(H[F-4])||e.x);e.by=f&&(c(H[F-3])||e.y);e.x=f&&H[F-2];e.y=f&&H[F-1]}return f?[d,f]:d},null,da),ua=C(function(a){for(var b=[],d=0,f=a[x];d<f;d++){var h={},e=a[d].match(/^([^:]*):?([\d\.]*)/);h.color=u.getRGB(e[1]); if(h.color.error)return null;h.color=h.color.hex;e[2]&&(h.offset=e[2]+"%");b[$](h)}d=1;for(f=b[x]-1;d<f;d++)if(!b[d].offset){a=c(b[d-1].offset||0);e=0;for(h=d+1;h<f;h++)if(b[h].offset){e=b[h].offset;break}if(!e){e=100;h=f}e=c(e);for(e=(e-a)/(h-d+1);d<h;d++){a+=e;b[d].offset=a+"%"}}return b}),ra=function(){var a;if(u.is(arguments[0],"string")||u.is(arguments[0],"object")){a=u.is(arguments[0],"string")?j.getElementById(arguments[0]):arguments[0];if(a.tagName)return arguments[1]==null?{container:a,width:a.style.pixelWidth|| a.offsetWidth,height:a.style.pixelHeight||a.offsetHeight}:{container:a,width:arguments[1],height:arguments[2]}}else if(u.is(arguments[0],ca)&&arguments[x]>3)return{container:1,x:arguments[0],y:arguments[1],width:arguments[2],height:arguments[3]}},Ca=function(a,b){var d=this,f;for(f in b)if(b[L](f)&&!(f in a))switch(typeof b[f]){case "function":(function(h){a[f]=a===d?h:function(){return h[K](d,arguments)}})(b[f]);break;case "object":a[f]=a[f]||{};Ca.call(this,a[f],b[f]);break;default:a[f]=b[f]}}, va=function(a,b){a==b.top&&(b.top=a.prev);a==b.bottom&&(b.bottom=a.next);a.next&&(a.next.prev=a.prev);a.prev&&(a.prev.next=a.next)},Ia=function(a,b){if(b.top!==a){va(a,b);a.next=null;a.prev=b.top;b.top.next=a;b.top=a}},Ja=function(a,b){if(b.bottom!==a){va(a,b);a.next=b.bottom;a.prev=null;b.bottom.prev=a;b.bottom=a}},Ka=function(a,b,d){va(a,d);b==d.top&&(d.top=a);b.next&&(b.next.prev=a);a.next=b.next;a.prev=b;b.next=a},La=function(a,b,d){va(a,d);b==d.bottom&&(d.bottom=a);b.prev&&(b.prev.next=a);a.prev= b.prev;b.prev=a;a.next=b},Ma=function(a){return function(){throw Error("Rapha\u00ebl: you are calling to method \u201c"+a+"\u201d of removed object");}},Na=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/;if(u.svg){I[B].svgns="http://www.w3.org/2000/svg";I[B].xlink="http://www.w3.org/1999/xlink";Z=function(a){return+a+(~~a===a)*0.5};var Za=function(a){for(var b=0,d=a[x];b<d;b++)if(S.call(a[b][0])!="a")for(var f=1,h=a[b][x];f<h;f++)a[b][f]=Z(a[b][f]);else{a[b][6]=Z(a[b][6]);a[b][7]=Z(a[b][7])}return a},P=function(a, b){if(b)for(var d in b)b[L](d)&&a.setAttribute(d,b[d]);else return j.createElementNS(I[B].svgns,a)};u.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\u00ebl "+this.version};var Oa=function(a,b){var d=P("path");b.canvas&&b.canvas.appendChild(d);d=new J(d,b);d.type="path";ma(d,{fill:"none",stroke:"#000",path:a});return d},xa=function(a,b,d){var f="linear",h=0.5,e=0.5,o=a.style;b=(b+"").replace(Na,function(z,A,H){f="radial";if(A&&H){h=c(A);e=c(H);z=(e>0.5)*2-1;U(h-0.5,2)+ U(e-0.5,2)>0.25&&(e=M.sqrt(0.25-U(h-0.5,2))*z+0.5)&&e!=0.5&&(e=e.toFixed(5)-1.0E-5*z)}return""});b=b.split(/\s*\-\s*/);if(f=="linear"){var m=b.shift();m=-c(m);if(isNaN(m))return null;var n=[0,0,M.cos(m*M.PI/180),M.sin(m*M.PI/180)];m=1/(ea(M.abs(n[2]),M.abs(n[3]))||1);n[2]*=m;n[3]*=m;if(n[2]<0){n[0]=-n[2];n[2]=0}if(n[3]<0){n[1]=-n[3];n[3]=0}}b=ua(b);if(!b)return null;m=P(f+"Gradient");m.id="r"+(u._id++).toString(36);P(m,f=="radial"?{fx:h,fy:e}:{x1:n[0],y1:n[1],x2:n[2],y2:n[3]});d.defs.appendChild(m); d=0;for(n=b[x];d<n;d++){var q=P("stop");P(q,{offset:b[d].offset?b[d].offset:!d?"0%":"100%","stop-color":b[d].color||"#fff"});m.appendChild(q)}P(a,{fill:"url(#"+m.id+")",opacity:1,"fill-opacity":1});o.fill="";o.opacity=1;return o.fillOpacity=1},Da=function(a){var b=a.getBBox();P(a.pattern,{patternTransform:u.format("translate({0},{1})",b.x,b.y)})},ma=function(a,b){var d={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8, 3,1,3],"--..":[8,3,1,3,1,3]},f=a.node,h=a.attrs,e=a.rotate(),o=function(F,D){if(D=d[S.call(D)]){for(var G=F.attrs["stroke-width"]||"1",T={round:G,square:G,butt:0}[F.attrs["stroke-linecap"]||b["stroke-linecap"]]||0,N=[],W=D[x];W--;)N[W]=D[W]*G+(W%2?1:-1)*T;P(f,{"stroke-dasharray":N[X](",")})}};b[L]("rotation")&&(e=b.rotation);var m=(e+"").split(g);if(m.length-1){m[1]=+m[1];m[2]=+m[2]}else m=null;c(e)&&a.rotate(0,true);for(var n in b)if(b[L](n))if(t[L](n)){var q=b[n];h[n]=q;switch(n){case "rotation":a.rotate(q, true);break;case "href":case "title":case "target":var z=f.parentNode;if(S.call(z.tagName)!="a"){var A=P("a");z.insertBefore(A,f);A.appendChild(f);z=A}z.setAttributeNS(a.paper.xlink,n,q);break;case "cursor":f.style.cursor=q;break;case "clip-rect":z=(q+"").split(g);if(z[x]==4){a.clip&&a.clip.parentNode.parentNode.removeChild(a.clip.parentNode);var H=P("clipPath");A=P("rect");H.id="r"+(u._id++).toString(36);P(A,{x:z[0],y:z[1],width:z[2],height:z[3]});H.appendChild(A);a.paper.defs.appendChild(H);P(f, {"clip-path":"url(#"+H.id+")"});a.clip=A}if(!q){(q=j.getElementById(f.getAttribute("clip-path").replace(/(^url\(#|\)$)/g,"")))&&q.parentNode.removeChild(q);P(f,{"clip-path":""});delete a.clip}break;case "path":if(q&&a.type=="path"){h.path=Za(ba(q));P(f,{d:h.path})}break;case "width":f.setAttribute(n,q);if(h.fx){n="x";q=h.x}else break;case "x":if(h.fx)q=-h.x-(h.width||0);case "rx":if(n=="rx"&&a.type=="rect")break;case "cx":m&&(n=="x"||n=="cx")&&(m[1]+=q-h[n]);f.setAttribute(n,Z(q));a.pattern&&Da(a); break;case "height":f.setAttribute(n,q);if(h.fy){n="y";q=h.y}else break;case "y":if(h.fy)q=-h.y-(h.height||0);case "ry":if(n=="ry"&&a.type=="rect")break;case "cy":m&&(n=="y"||n=="cy")&&(m[2]+=q-h[n]);f.setAttribute(n,Z(q));a.pattern&&Da(a);break;case "r":a.type=="rect"?P(f,{rx:q,ry:q}):f.setAttribute(n,q);break;case "src":a.type=="image"&&f.setAttributeNS(a.paper.xlink,"href",q);break;case "stroke-width":f.style.strokeWidth=q;f.setAttribute(n,q);h["stroke-dasharray"]&&o(a,h["stroke-dasharray"]);break; case "stroke-dasharray":o(a,q);break;case "translation":q=(q+"").split(g);q[0]=+q[0]||0;q[1]=+q[1]||0;if(m){m[1]+=q[0];m[2]+=q[1]}za.call(a,q[0],q[1]);break;case "scale":q=(q+"").split(g);a.scale(+q[0]||1,+q[1]||+q[0]||1,+q[2]||null,+q[3]||null);break;case "fill":if(z=(q+"").match(wa)){H=P("pattern");var R=P("image");H.id="r"+(u._id++).toString(36);P(H,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});P(R,{x:0,y:0});R.setAttributeNS(a.paper.xlink,"href",z[1]);H.appendChild(R);q=j.createElement("img"); q.style.cssText="position:absolute;left:-9999em;top-9999em";q.onload=function(){P(H,{width:this.offsetWidth,height:this.offsetHeight});P(R,{width:this.offsetWidth,height:this.offsetHeight});j.body.removeChild(this);a.paper.safari()};j.body.appendChild(q);q.src=z[1];a.paper.defs.appendChild(H);f.style.fill="url(#"+H.id+")";P(f,{fill:"url(#"+H.id+")"});a.pattern=H;a.pattern&&Da(a);break}if(u.getRGB(q).error){if(({circle:1,ellipse:1}[L](a.type)||(q+"").charAt()!="r")&&xa(f,q,a.paper)){h.gradient=q;h.fill= "none";break}}else{delete b.gradient;delete h.gradient;!u.is(h.opacity,"undefined")&&u.is(b.opacity,"undefined")&&P(f,{opacity:h.opacity});!u.is(h["fill-opacity"],"undefined")&&u.is(b["fill-opacity"],"undefined")&&P(f,{"fill-opacity":h["fill-opacity"]})}case "stroke":f.setAttribute(n,u.getRGB(q).hex);break;case "gradient":(({circle:1,ellipse:1})[L](a.type)||(q+"").charAt()!="r")&&xa(f,q,a.paper);break;case "opacity":case "fill-opacity":if(h.gradient){if(z=j.getElementById(f.getAttribute("fill").replace(/^url\(#|\)$/g, ""))){z=z.getElementsByTagName("stop");z[z[x]-1].setAttribute("stop-opacity",q)}break}default:n=="font-size"&&(q=k(q,10)+"px");z=n.replace(/(\-.)/g,function(F){return p.call(F.substring(1))});f.style[z]=q;f.setAttribute(n,q)}}$a(a,b);if(m)a.rotate(m.join(Q));else c(e)&&a.rotate(e,true)},$a=function(a,b){if(!(a.type!="text"||!(b[L]("text")||b[L]("font")||b[L]("font-size")||b[L]("x")||b[L]("y")))){var d=a.attrs,f=a.node,h=f.firstChild?k(j.defaultView.getComputedStyle(f.firstChild,"").getPropertyValue("font-size"), 10):10;if(b[L]("text")){for(d.text=b.text;f.firstChild;)f.removeChild(f.firstChild);for(var e=(b.text+"").split("\n"),o=0,m=e[x];o<m;o++)if(e[o]){var n=P("tspan");o&&P(n,{dy:h*1.2,x:d.x});n.appendChild(j.createTextNode(e[o]));f.appendChild(n)}}else{e=f.getElementsByTagName("tspan");o=0;for(m=e[x];o<m;o++)o&&P(e[o],{dy:h*1.2,x:d.x})}P(f,{y:d.y});h=a.getBBox();(h=d.y-(h.y+h.height/2))&&isFinite(h)&&P(f,{y:d.y+h})}},J=function(a,b){this[0]=a;this.id=u._oid++;this.node=a;a.raphael=this;this.paper=b;this.attrs= this.attrs||{};this.transformations=[];this._={tx:0,ty:0,rt:{deg:0,cx:0,cy:0},sx:1,sy:1};!b.bottom&&(b.bottom=this);(this.prev=b.top)&&(b.top.next=this);b.top=this;this.next=null};J[B].rotate=function(a,b,d){if(this.removed)return this;if(a==null){if(this._.rt.cx)return[this._.rt.deg,this._.rt.cx,this._.rt.cy][X](Q);return this._.rt.deg}var f=this.getBBox();a=(a+"").split(g);if(a[x]-1){b=c(a[1]);d=c(a[2])}a=c(a[0]);if(b!=null)this._.rt.deg=a;else this._.rt.deg+=a;d==null&&(b=null);this._.rt.cx=b; this._.rt.cy=d;b=b==null?f.x+f.width/2:b;d=d==null?f.y+f.height/2:d;if(this._.rt.deg){this.transformations[0]=u.format("rotate({0} {1} {2})",this._.rt.deg,b,d);this.clip&&P(this.clip,{transform:u.format("rotate({0} {1} {2})",-this._.rt.deg,b,d)})}else{this.transformations[0]="";this.clip&&P(this.clip,{transform:""})}P(this.node,{transform:this.transformations[X](Q)});return this};J[B].hide=function(){!this.removed&&(this.node.style.display="none");return this};J[B].show=function(){!this.removed&& (this.node.style.display="");return this};J[B].remove=function(){if(!this.removed){va(this,this.paper);this.node.parentNode.removeChild(this.node);for(var a in this)delete this[a];this.removed=true}};J[B].getBBox=function(){if(this.removed)return this;if(this.type=="path")return V(this.attrs.path);if(this.node.style.display=="none"){this.show();var a=true}var b={};try{b=this.node.getBBox()}catch(d){}finally{b=b||{}}if(this.type=="text"){b={x:b.x,y:Infinity,width:0,height:0};for(var f=0,h=this.node.getNumberOfChars();f< h;f++){var e=this.node.getExtentOfChar(f);e.y<b.y&&(b.y=e.y);e.y+e.height-b.y>b.height&&(b.height=e.y+e.height-b.y);e.x+e.width-b.x>b.width&&(b.width=e.x+e.width-b.x)}}a&&this.hide();return b};J[B].attr=function(){if(this.removed)return this;if(arguments[x]==0){var a={},b;for(b in this.attrs)if(this.attrs[L](b))a[b]=this.attrs[b];this._.rt.deg&&(a.rotation=this.rotate());(this._.sx!=1||this._.sy!=1)&&(a.scale=this.scale());a.gradient&&a.fill=="none"&&(a.fill=a.gradient)&&delete a.gradient;return a}if(arguments[x]== 1&&u.is(arguments[0],"string")){if(arguments[0]=="translation")return za.call(this);if(arguments[0]=="rotation")return this.rotate();if(arguments[0]=="scale")return this.scale();if(arguments[0]=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;return this.attrs[arguments[0]]}if(arguments[x]==1&&u.is(arguments[0],"array")){b={};for(a in arguments[0])if(arguments[0][L](a))b[arguments[0][a]]=this.attrs[arguments[0][a]];return b}if(arguments[x]==2){b={};b[arguments[0]]= arguments[1];ma(this,b)}else arguments[x]==1&&u.is(arguments[0],"object")&&ma(this,arguments[0]);return this};J[B].toFront=function(){if(this.removed)return this;this.node.parentNode.appendChild(this.node);var a=this.paper;a.top!=this&&Ia(this,a);return this};J[B].toBack=function(){if(this.removed)return this;if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);Ja(this,this.paper)}return this};J[B].insertAfter=function(a){if(this.removed)return this; var b=a.node;b.nextSibling?b.parentNode.insertBefore(this.node,b.nextSibling):b.parentNode.appendChild(this.node);Ka(this,a,this.paper);return this};J[B].insertBefore=function(a){if(this.removed)return this;var b=a.node;b.parentNode.insertBefore(this.node,b);La(this,a,this.paper);return this};var Pa=function(a,b,d,f){b=Z(b);d=Z(d);var h=P("circle");a.canvas&&a.canvas.appendChild(h);a=new J(h,a);a.attrs={cx:b,cy:d,r:f,fill:"none",stroke:"#000"};a.type="circle";P(h,a.attrs);return a},Qa=function(a, b,d,f,h,e){b=Z(b);d=Z(d);var o=P("rect");a.canvas&&a.canvas.appendChild(o);a=new J(o,a);a.attrs={x:b,y:d,width:f,height:h,r:e||0,rx:e||0,ry:e||0,fill:"none",stroke:"#000"};a.type="rect";P(o,a.attrs);return a},Ra=function(a,b,d,f,h){b=Z(b);d=Z(d);var e=P("ellipse");a.canvas&&a.canvas.appendChild(e);a=new J(e,a);a.attrs={cx:b,cy:d,rx:f,ry:h,fill:"none",stroke:"#000"};a.type="ellipse";P(e,a.attrs);return a},Sa=function(a,b,d,f,h,e){var o=P("image");P(o,{x:d,y:f,width:h,height:e,preserveAspectRatio:"none"}); o.setAttributeNS(a.xlink,"href",b);a.canvas&&a.canvas.appendChild(o);a=new J(o,a);a.attrs={x:d,y:f,width:h,height:e,src:b};a.type="image";return a},Ta=function(a,b,d,f){var h=P("text");P(h,{x:b,y:d,"text-anchor":"middle"});a.canvas&&a.canvas.appendChild(h);a=new J(h,a);a.attrs={x:b,y:d,"text-anchor":"middle",text:f,font:t.font,stroke:"none",fill:"#000"};a.type="text";ma(a,a.attrs);return a},Ua=function(a,b){this.width=a||this.width;this.height=b||this.height;this.canvas.setAttribute("width",this.width); this.canvas.setAttribute("height",this.height);return this},Ba=function(){var a=ra[K](null,arguments),b=a&&a.container,d=a.x,f=a.y,h=a.width;a=a.height;if(!b)throw Error("SVG container not found.");var e=P("svg");h=h||512;a=a||342;P(e,{xmlns:"http://www.w3.org/2000/svg",version:1.1,width:h,height:a});if(b==1){e.style.cssText="position:absolute;left:"+d+"px;top:"+f+"px";j.body.appendChild(e)}else b.firstChild?b.insertBefore(e,b.firstChild):b.appendChild(e);b=new I;b.width=h;b.height=a;b.canvas=e;Ca.call(b, b,u.fn);b.clear();return b};I[B].clear=function(){for(var a=this.canvas;a.firstChild;)a.removeChild(a.firstChild);this.bottom=this.top=null;(this.desc=P("desc")).appendChild(j.createTextNode("Created with Rapha\u00ebl"));a.appendChild(this.desc);a.appendChild(this.defs=P("defs"))};I[B].remove=function(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]=Ma(a)}}if(u.vml){var ab=function(a){var b=/[ahqstv]/ig,d=ba;(a+"").match(b)&&(d=ja);b=/[clmz]/g;if(d== ba&&!(a+"").match(b)){var f={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},h=/-?[^,\s-]+/g;return a=(a+"").replace(/([clmz]),?([^clmz]*)/gi,function(z,A,H){var R=[];H.replace(h,function(F){R[$](Z(F))});return f[A]+R})}b=d(a);a=[];for(var e,o=0,m=b[x];o<m;o++){d=b[o];e=S.call(b[o][0]);e=="z"&&(e="x");for(var n=1,q=d[x];n<q;n++)e+=Z(d[n])+(n!=q-1?",":"");a[$](e)}return a[X](Q)};u.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\u00ebl "+ this.version};Oa=function(a,b){var d=fa("group");d.style.cssText="position:absolute;left:0;top:0;width:"+b.width+"px;height:"+b.height+"px";d.coordsize=b.coordsize;d.coordorigin=b.coordorigin;var f=fa("shape"),h=f.style;h.width=b.width+"px";h.height=b.height+"px";f.coordsize=this.coordsize;f.coordorigin=this.coordorigin;d.appendChild(f);f=new J(f,d,b);f.isAbsolute=true;f.type="path";f.path=[];f.Path="";a&&ma(f,{fill:"none",stroke:"#000",path:a});b.canvas.appendChild(d);return f};ma=function(a,b){a.attrs= a.attrs||{};var d=a.node,f=a.attrs,h=d.style,e;for(e in b)if(b[L](e))f[e]=b[e];b.href&&(d.href=b.href);b.title&&(d.title=b.title);b.target&&(d.target=b.target);b.cursor&&(h.cursor=b.cursor);if(b.path&&a.type=="path"){f.path=b.path;d.path=ab(f.path)}b.rotation!=null&&a.rotate(b.rotation,true);if(b.translation){e=(b.translation+"").split(g);za.call(a,e[0],e[1]);if(a._.rt.cx!=null){a._.rt.cx+=+e[0];a._.rt.cy+=+e[1];a.setBox(a.attrs,e[0],e[1])}}if(b.scale){e=(b.scale+"").split(g);a.scale(+e[0]||1,+e[1]|| +e[0]||1,+e[2]||null,+e[3]||null)}if("clip-rect"in b){e=(b["clip-rect"]+"").split(g);if(e[x]==4){e[2]=+e[2]+ +e[0];e[3]=+e[3]+ +e[1];var o=d.clipRect||j.createElement("div"),m=o.style,n=d.parentNode;m.clip=u.format("rect({1}px {2}px {3}px {0}px)",e);if(!d.clipRect){m.position="absolute";m.top=0;m.left=0;m.width=a.paper.width+"px";m.height=a.paper.height+"px";n.parentNode.insertBefore(o,n);o.appendChild(n);d.clipRect=o}}if(!b["clip-rect"])d.clipRect&&(d.clipRect.style.clip="")}if(a.type=="image"&& b.src)d.src=b.src;if(a.type=="image"&&b.opacity){d.filterOpacity=" progid:DXImageTransform.Microsoft.Alpha(opacity="+b.opacity*100+")";h.filter=(d.filterMatrix||"")+(d.filterOpacity||"")}b.font&&(h.font=b.font);b["font-family"]&&(h.fontFamily='"'+b["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,"")+'"');b["font-size"]&&(h.fontSize=b["font-size"]);b["font-weight"]&&(h.fontWeight=b["font-weight"]);b["font-style"]&&(h.fontStyle=b["font-style"]);if(b.opacity!=null||b["stroke-width"]!=null||b.fill!= null||b.stroke!=null||b["stroke-width"]!=null||b["stroke-opacity"]!=null||b["fill-opacity"]!=null||b["stroke-dasharray"]!=null||b["stroke-miterlimit"]!=null||b["stroke-linejoin"]!=null||b["stroke-linecap"]!=null){d=a.shape||d;e=d.getElementsByTagName("fill")&&d.getElementsByTagName("fill")[0];o=false;!e&&(o=e=fa("fill"));if("fill-opacity"in b||"opacity"in b){h=((+f["fill-opacity"]+1||2)-1)*((+f.opacity+1||2)-1);h<0&&(h=0);h>1&&(h=1);e.opacity=h}b.fill&&(e.on=true);if(e.on==null||b.fill=="none")e.on= false;if(e.on&&b.fill)if(h=b.fill.match(wa)){e.src=h[1];e.type="tile"}else{e.color=u.getRGB(b.fill).hex;e.src="";e.type="solid";if(u.getRGB(b.fill).error&&(a.type in{circle:1,ellipse:1}||(b.fill+"").charAt()!="r")&&xa(a,b.fill)){f.fill="none";f.gradient=b.fill}}o&&d.appendChild(e);e=d.getElementsByTagName("stroke")&&d.getElementsByTagName("stroke")[0];o=false;!e&&(o=e=fa("stroke"));if(b.stroke&&b.stroke!="none"||b["stroke-width"]||b["stroke-opacity"]!=null||b["stroke-dasharray"]||b["stroke-miterlimit"]|| b["stroke-linejoin"]||b["stroke-linecap"])e.on=true;(b.stroke=="none"||e.on==null||b.stroke==0||b["stroke-width"]==0)&&(e.on=false);e.on&&b.stroke&&(e.color=u.getRGB(b.stroke).hex);h=((+f["stroke-opacity"]+1||2)-1)*((+f.opacity+1||2)-1);m=(c(b["stroke-width"])||1)*0.75;h<0&&(h=0);h>1&&(h=1);b["stroke-width"]==null&&(m=f["stroke-width"]);b["stroke-width"]&&(e.weight=m);m&&m<1&&(h*=m)&&(e.weight=1);e.opacity=h;b["stroke-linejoin"]&&(e.joinstyle=b["stroke-linejoin"]||"miter");e.miterlimit=b["stroke-miterlimit"]|| 8;b["stroke-linecap"]&&(e.endcap=b["stroke-linecap"]=="butt"?"flat":b["stroke-linecap"]=="square"?"square":"round");if(b["stroke-dasharray"]){h={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};e.dashstyle=h[L](b["stroke-dasharray"])?h[b["stroke-dasharray"]]:""}o&&d.appendChild(e)}if(a.type=="text"){h=a.paper.span.style;f.font&&(h.font=f.font);f["font-family"]&&(h.fontFamily= f["font-family"]);f["font-size"]&&(h.fontSize=f["font-size"]);f["font-weight"]&&(h.fontWeight=f["font-weight"]);f["font-style"]&&(h.fontStyle=f["font-style"]);a.node.string&&(a.paper.span.innerHTML=(a.node.string+"").replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));a.W=f.w=a.paper.span.offsetWidth;a.H=f.h=a.paper.span.offsetHeight;a.X=f.x;a.Y=f.y+Z(a.H/2);switch(f["text-anchor"]){case "start":a.node.style["v-text-align"]="left";a.bbx=Z(a.W/2);break;case "end":a.node.style["v-text-align"]= "right";a.bbx=-Z(a.W/2);break;default:a.node.style["v-text-align"]="center"}}};xa=function(a,b){a.attrs=a.attrs||{};var d=a.node.getElementsByTagName("fill"),f="linear",h=".5 .5";a.attrs.gradient=b;b=(b+"").replace(Na,function(z,A,H){f="radial";if(A&&H){A=c(A);H=c(H);U(A-0.5,2)+U(H-0.5,2)>0.25&&(H=M.sqrt(0.25-U(A-0.5,2))*((H>0.5)*2-1)+0.5);h=A+Q+H}return""});b=b.split(/\s*\-\s*/);if(f=="linear"){var e=b.shift();e=-c(e);if(isNaN(e))return null}var o=ua(b);if(!o)return null;a=a.shape||a.node;d=d[0]|| fa("fill");if(o[x]){d.on=true;d.method="none";d.type=f=="radial"?"gradientradial":"gradient";d.color=o[0].color;d.color2=o[o[x]-1].color;for(var m=[],n=0,q=o[x];n<q;n++)o[n].offset&&m[$](o[n].offset+Q+o[n].color);d.colors&&(d.colors.value=m[x]?m[X](","):"0% "+d.color);if(f=="radial"){d.focus="100%";d.focussize=h;d.focusposition=h}else d.angle=(270-e)%360}return 1};J=function(a,b,d){this[0]=a;this.id=u._oid++;this.node=a;a.raphael=this;this.Y=this.X=0;this.attrs={};this.Group=b;this.paper=d;this._= {tx:0,ty:0,rt:{deg:0},sx:1,sy:1};!d.bottom&&(d.bottom=this);(this.prev=d.top)&&(d.top.next=this);d.top=this;this.next=null};J[B].rotate=function(a,b,d){if(this.removed)return this;if(a==null){if(this._.rt.cx)return[this._.rt.deg,this._.rt.cx,this._.rt.cy][X](Q);return this._.rt.deg}a=(a+"").split(g);if(a[x]-1){b=c(a[1]);d=c(a[2])}a=c(a[0]);if(b!=null)this._.rt.deg=a;else this._.rt.deg+=a;d==null&&(b=null);this._.rt.cx=b;this._.rt.cy=d;this.setBox(this.attrs,b,d);this.Group.style.rotation=this._.rt.deg; return this};J[B].setBox=function(a,b,d){if(this.removed)return this;var f=this.Group.style,h=this.shape&&this.shape.style||this.node.style;a=a||{};for(var e in a)if(a[L](e))this.attrs[e]=a[e];b=b||this._.rt.cx;d=d||this._.rt.cy;var o=this.attrs,m,n,q;switch(this.type){case "circle":e=o.cx-o.r;m=o.cy-o.r;n=q=o.r*2;break;case "ellipse":e=o.cx-o.rx;m=o.cy-o.ry;n=o.rx*2;q=o.ry*2;break;case "rect":case "image":e=+o.x;m=+o.y;n=o.width||0;q=o.height||0;break;case "text":this.textpath.v=["m",Z(o.x),", ", Z(o.y-2),"l",Z(o.x)+1,", ",Z(o.y-2)][X]("");e=o.x-Z(this.W/2);m=o.y-this.H/2;n=this.W;q=this.H;break;case "path":if(this.attrs.path){q=V(this.attrs.path);e=q.x;m=q.y;n=q.width;q=q.height}else{m=e=0;n=this.paper.width;q=this.paper.height}break;default:m=e=0;n=this.paper.width;q=this.paper.height}b=(b==null?e+n/2:b)-this.paper.width/2;d=(d==null?m+q/2:d)-this.paper.height/2;if(this.type=="path"||this.type=="text"){f.left!=b+"px"&&(f.left=b+"px");f.top!=d+"px"&&(f.top=d+"px");this.X=this.type=="text"? e:-b;this.Y=this.type=="text"?m:-d;this.W=n;this.H=q;h.left!=-b+"px"&&(h.left=-b+"px");h.top!=-d+"px"&&(h.top=-d+"px")}else{f.left!=b+"px"&&(f.left=b+"px");f.top!=d+"px"&&(f.top=d+"px");this.X=e;this.Y=m;this.W=n;this.H=q;f.width!=this.paper.width+"px"&&(f.width=this.paper.width+"px");f.height!=this.paper.height+"px"&&(f.height=this.paper.height+"px");h.left!=e-b+"px"&&(h.left=e-b+"px");h.top!=m-d+"px"&&(h.top=m-d+"px");h.width!=n+"px"&&(h.width=n+"px");h.height!=q+"px"&&(h.height=q+"px");a=(+a.r|| 0)/ka(n,q);if(this.type=="rect"&&this.arcsize.toFixed(4)!=a.toFixed(4)&&(a||this.arcsize)){f=fa("roundrect");h={};e=0;d=this.events&&this.events[x];f.arcsize=a;f.raphael=this;this.Group.appendChild(f);this.Group.removeChild(this.node);this[0]=this.node=f;this.arcsize=a;for(e in o)h[e]=o[e];delete h.scale;this.attr(h);if(this.events)for(;e<d;e++)this.events[e].unbind=Va(this.node,this.events[e].name,this.events[e].f,this)}}};J[B].hide=function(){!this.removed&&(this.Group.style.display="none");return this}; J[B].show=function(){!this.removed&&(this.Group.style.display="block");return this};J[B].getBBox=function(){if(this.removed)return this;if(this.type=="path")return V(this.attrs.path);return{x:this.X+(this.bbx||0),y:this.Y,width:this.W,height:this.H}};J[B].remove=function(){if(!this.removed){va(this,this.paper);this.node.parentNode.removeChild(this.node);this.Group.parentNode.removeChild(this.Group);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var a in this)delete this[a];this.removed= true}};J[B].attr=function(){if(this.removed)return this;if(arguments[x]==0){var a={},b;for(b in this.attrs)if(this.attrs[L](b))a[b]=this.attrs[b];this._.rt.deg&&(a.rotation=this.rotate());(this._.sx!=1||this._.sy!=1)&&(a.scale=this.scale());a.gradient&&a.fill=="none"&&(a.fill=a.gradient)&&delete a.gradient;return a}if(arguments[x]==1&&u.is(arguments[0],"string")){if(arguments[0]=="translation")return za.call(this);if(arguments[0]=="rotation")return this.rotate();if(arguments[0]=="scale")return this.scale(); if(arguments[0]=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;return this.attrs[arguments[0]]}if(this.attrs&&arguments[x]==1&&u.is(arguments[0],"array")){a={};b=0;for(var d=arguments[0][x];b<d;b++)a[arguments[0][b]]=this.attrs[arguments[0][b]];return a}if(arguments[x]==2){a={};a[arguments[0]]=arguments[1]}arguments[x]==1&&u.is(arguments[0],"object")&&(a=arguments[0]);if(a){if(a.text&&this.type=="text")this.node.string=a.text;ma(this,a);if(a.gradient&&({circle:1, ellipse:1}[L](this.type)||(a.gradient+"").charAt()!="r"))xa(this,a.gradient);(this.type!="path"||this._.rt.deg)&&this.setBox(this.attrs)}return this};J[B].toFront=function(){!this.removed&&this.Group.parentNode.appendChild(this.Group);this.paper.top!=this&&Ia(this,this.paper);return this};J[B].toBack=function(){if(this.removed)return this;if(this.Group.parentNode.firstChild!=this.Group){this.Group.parentNode.insertBefore(this.Group,this.Group.parentNode.firstChild);Ja(this,this.paper)}return this}; J[B].insertAfter=function(a){if(this.removed)return this;a.Group.nextSibling?a.Group.parentNode.insertBefore(this.Group,a.Group.nextSibling):a.Group.parentNode.appendChild(this.Group);Ka(this,a,this.paper);return this};J[B].insertBefore=function(a){if(this.removed)return this;a.Group.parentNode.insertBefore(this.Group,a.Group);La(this,a,this.paper);return this};Pa=function(a,b,d,f){var h=fa("group"),e=fa("oval");h.style.cssText="position:absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+ "px";h.coordsize=a.coordsize;h.coordorigin=a.coordorigin;h.appendChild(e);e=new J(e,h,a);e.type="circle";ma(e,{stroke:"#000",fill:"none"});e.attrs.cx=b;e.attrs.cy=d;e.attrs.r=f;e.setBox({x:b-f,y:d-f,width:f*2,height:f*2});a.canvas.appendChild(h);return e};Qa=function(a,b,d,f,h,e){var o=fa("group"),m=fa("roundrect"),n=(+e||0)/ka(f,h);o.style.cssText="position:absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px";o.coordsize=a.coordsize;o.coordorigin=a.coordorigin;o.appendChild(m);m.arcsize= n;m=new J(m,o,a);m.type="rect";ma(m,{stroke:"#000"});m.arcsize=n;m.setBox({x:b,y:d,width:f,height:h,r:e});a.canvas.appendChild(o);return m};Ra=function(a,b,d,f,h){var e=fa("group"),o=fa("oval");e.style.cssText="position:absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px";e.coordsize=a.coordsize;e.coordorigin=a.coordorigin;e.appendChild(o);o=new J(o,e,a);o.type="ellipse";ma(o,{stroke:"#000"});o.attrs.cx=b;o.attrs.cy=d;o.attrs.rx=f;o.attrs.ry=h;o.setBox({x:b-f,y:d-h,width:f*2,height:h* 2});a.canvas.appendChild(e);return o};Sa=function(a,b,d,f,h,e){var o=fa("group"),m=fa("image");o.style.cssText="position:absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px";o.coordsize=a.coordsize;o.coordorigin=a.coordorigin;m.src=b;o.appendChild(m);m=new J(m,o,a);m.type="image";m.attrs.src=b;m.attrs.x=d;m.attrs.y=f;m.attrs.w=h;m.attrs.h=e;m.setBox({x:d,y:f,width:h,height:e});a.canvas.appendChild(o);return m};Ta=function(a,b,d,f){var h=fa("group"),e=fa("shape"),o=e.style,m=fa("path"), n=fa("textpath");h.style.cssText="position:absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px";h.coordsize=a.coordsize;h.coordorigin=a.coordorigin;m.v=u.format("m{0},{1}l{2},{1}",Z(b),Z(d),Z(b)+1);m.textpathok=true;o.width=a.width;o.height=a.height;n.string=f+"";n.on=true;e.appendChild(n);e.appendChild(m);h.appendChild(e);o=new J(n,h,a);o.shape=e;o.textpath=m;o.type="text";o.attrs.text=f;o.attrs.x=b;o.attrs.y=d;o.attrs.w=1;o.attrs.h=1;ma(o,{font:t.font,stroke:"none",fill:"#000"});o.setBox(); a.canvas.appendChild(h);return o};Ua=function(a,b){var d=this.canvas.style;a==+a&&(a+="px");b==+b&&(b+="px");d.width=a;d.height=b;d.clip="rect(0 "+a+" "+b+" 0)";return this};var fa;j.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!j.namespaces.rvml&&j.namespaces.add("rvml","urn:schemas-microsoft-com:vml");fa=function(a){return j.createElement("<rvml:"+a+' class="rvml">')}}catch(cb){fa=function(a){return j.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}Ba= function(){var a=ra[K](null,arguments),b=a.container,d=a.height,f=a.width,h=a.x;a=a.y;if(!b)throw Error("VML container not found.");var e=new I,o=e.canvas=j.createElement("div"),m=o.style;f=f||512;d=d||342;f==+f&&(f+="px");d==+d&&(d+="px");e.width=1E3;e.height=1E3;e.coordsize="1000 1000";e.coordorigin="0 0";e.span=j.createElement("span");e.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";o.appendChild(e.span);m.cssText=u.format("width:{0};height:{1};position:absolute;clip:rect(0 {0} {1} 0);overflow:hidden", f,d);if(b==1){j.body.appendChild(o);m.left=h+"px";m.top=a+"px"}else{b.style.width=f;b.style.height=d;b.firstChild?b.insertBefore(o,b.firstChild):b.appendChild(o)}Ca.call(e,e,u.fn);return e};I[B].clear=function(){this.canvas.innerHTML="";this.span=j.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null};I[B].remove=function(){this.canvas.parentNode.removeChild(this.canvas); for(var a in this)this[a]=Ma(a)}}I[B].safari=/^Apple|^Google/.test(navigator.vendor)&&!(navigator.userAgent.indexOf("Version/4.0")+1)?function(){var a=this.rect(-99,-99,this.width+99,this.height+99);setTimeout(function(){a.remove()})}:function(){};var Va=function(){if(j.addEventListener)return function(a,b,d,f){var h=function(e){return d.call(f,e)};a.addEventListener(b,h,false);return function(){a.removeEventListener(b,h,false);return true}};else if(j.attachEvent)return function(a,b,d,f){var h=function(e){return d.call(f, e||r.event)};a.attachEvent("on"+b,h);return function(){a.detachEvent("on"+b,h);return true}}}();for(y=Y[x];y--;)(function(a){J[B][a]=function(b){if(u.is(b,"function")){this.events=this.events||[];this.events.push({name:a,f:b,unbind:Va(this.shape||this.node,a,b,this)})}return this};J[B]["un"+a]=function(b){for(var d=this.events,f=d[x];f--;)if(d[f].name==a&&d[f].f==b){d[f].unbind();d.splice(f,1);!d.length&&delete this.events;break}return this}})(Y[y]);J[B].hover=function(a,b){return this.mouseover(a).mouseout(b)}; J[B].unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};I[B].circle=function(a,b,d){return Pa(this,a||0,b||0,d||0)};I[B].rect=function(a,b,d,f,h){return Qa(this,a||0,b||0,d||0,f||0,h||0)};I[B].ellipse=function(a,b,d,f){return Ra(this,a||0,b||0,d||0,f||0)};I[B].path=function(a){a&&!u.is(a,"string")&&!u.is(a[0],"array")&&(a+="");return Oa(u.format[K](u,arguments),this)};I[B].image=function(a,b,d,f,h){return Sa(this,a||"about:blank",b||0,d||0,f||0,h||0)};I[B].text=function(a,b,d){return Ta(this, a||0,b||0,d||"")};I[B].set=function(a){arguments[x]>1&&(a=Array[B].splice.call(arguments,0,arguments[x]));return new oa(a)};I[B].setSize=Ua;I[B].top=I[B].bottom=null;I[B].raphael=u;J[B].scale=function(a,b,d,f){if(a==null&&b==null)return{x:this._.sx,y:this._.sy,toString:s};b=b||a;!+b&&(b=a);var h,e,o=this.attrs;if(a!=0){var m=this.getBBox(),n=m.x+m.width/2,q=m.y+m.height/2;h=a/this._.sx;e=b/this._.sy;d=+d||d==0?d:n;f=+f||f==0?f:q;m=~~(a/M.abs(a));var z=~~(b/M.abs(b)),A=this.node.style,H=d+(n-d)*h; q=f+(q-f)*e;switch(this.type){case "rect":case "image":var R=o.width*m*h,F=o.height*z*e;this.attr({height:F,r:o.r*ka(m*h,z*e),width:R,x:H-R/2,y:q-F/2});break;case "circle":case "ellipse":this.attr({rx:o.rx*m*h,ry:o.ry*z*e,r:o.r*ka(m*h,z*e),cx:H,cy:q});break;case "path":n=qa(o.path);for(var D=true,G=0,T=n[x];G<T;G++){var N=n[G],W;W=p.call(N[0]);if(!(W=="M"&&D)){D=false;if(W=="A"){N[n[G][x]-2]*=h;N[n[G][x]-1]*=e;N[1]*=m*h;N[2]*=z*e;N[5]=+(m+z?!!+N[5]:!+N[5])}else if(W=="H"){W=1;for(jj=N[x];W<jj;W++)N[W]*= h}else if(W=="V"){W=1;for(jj=N[x];W<jj;W++)N[W]*=e}else{W=1;for(jj=N[x];W<jj;W++)N[W]*=W%2?h:e}}}e=V(n);h=H-e.x-e.width/2;e=q-e.y-e.height/2;n[0][1]+=h;n[0][2]+=e;this.attr({path:n})}if(this.type in{text:1,image:1}&&(m!=1||z!=1))if(this.transformations){this.transformations[2]="scale(".concat(m,",",z,")");this.node.setAttribute("transform",this.transformations[X](Q));h=m==-1?-o.x-(R||0):o.x;e=z==-1?-o.y-(F||0):o.y;this.attr({x:h,y:e});o.fx=m-1;o.fy=z-1}else{this.node.filterMatrix=" progid:DXImageTransform.Microsoft.Matrix(M11=".concat(m, ", M12=0, M21=0, M22=",z,", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')");A.filter=(this.node.filterMatrix||"")+(this.node.filterOpacity||"")}else if(this.transformations){this.transformations[2]="";this.node.setAttribute("transform",this.transformations[X](Q));o.fx=0;o.fy=0}else{this.node.filterMatrix="";A.filter=(this.node.filterMatrix||"")+(this.node.filterOpacity||"")}o.scale=[a,b,d,f][X](Q);this._.sx=a;this._.sy=b}return this};J[B].clone=function(){var a=this.attr();delete a.scale; delete a.translation;return this.paper[this.type]().attr(a)};Y=function(a,b){return function(d,f,h){d=ja(d);for(var e,o,m,n,q="",z={},A=0,H=0,R=d.length;H<R;H++){m=d[H];if(m[0]=="M"){e=+m[1];o=+m[2]}else{n=bb(e,o,m[1],m[2],m[3],m[4],m[5],m[6]);if(A+n>f){if(b&&!z.start){e=u.findDotsAtSegment(e,o,m[1],m[2],m[3],m[4],m[5],m[6],(f-A)/n);q+=["C",e.start.x,e.start.y,e.m.x,e.m.y,e.x,e.y];if(h)return q;z.start=q;q=["M",e.x,e.y+"C",e.n.x,e.n.y,e.end.x,e.end.y,m[5],m[6]][X]();A+=n;e=+m[5];o=+m[6];continue}if(!a&& !b){e=u.findDotsAtSegment(e,o,m[1],m[2],m[3],m[4],m[5],m[6],(f-A)/n);return{x:e.x,y:e.y,alpha:e.alpha}}}A+=n;e=+m[5];o=+m[6]}q+=m}z.end=q;e=a?A:b?z:u.findDotsAtSegment(e,o,m[1],m[2],m[3],m[4],m[5],m[6],1);e.alpha&&(e={x:e.x,y:e.y,alpha:e.alpha});return e}};var bb=C(function(a,b,d,f,h,e,o,m){for(var n={x:0,y:0},q=0,z=0;z<1.01;z+=0.01){var A=la(a,b,d,f,h,e,o,m,z);z&&(q+=M.sqrt(U(n.x-A.x,2)+U(n.y-A.y,2)));n=A}return q}),Wa=Y(1),Aa=Y(),Ea=Y(0,1);J[B].getTotalLength=function(){if(this.type=="path")return Wa(this.attrs.path)}; J[B].getPointAtLength=function(a){if(this.type=="path")return Aa(this.attrs.path,a)};J[B].getSubpath=function(a,b){if(this.type=="path"){if(M.abs(this.getTotalLength()-b)<1.0E-6)return Ea(this.attrs.path,a).end;var d=Ea(this.attrs.path,b,1);return a?Ea(d,a).end:d}};u.easing_formulas={linear:function(a){return a},"<":function(a){return U(a,3)},">":function(a){return U(a-1,3)+1},"<>":function(a){a*=2;if(a<1)return U(a,3)/2;a-=2;return(U(a,3)+2)/2},backIn:function(a){return a*a*(2.70158*a-1.70158)}, backOut:function(a){a-=1;return a*a*(2.70158*a+1.70158)+1},elastic:function(a){if(a==0||a==1)return a;return U(2,-10*a)*M.sin((a-0.075)*2*M.PI/0.3)+1},bounce:function(a){if(a<1/2.75)a*=7.5625*a;else if(a<2/2.75){a-=1.5/2.75;a=7.5625*a*a+0.75}else if(a<2.5/2.75){a-=2.25/2.75;a=7.5625*a*a+0.9375}else{a-=2.625/2.75;a=7.5625*a*a+0.984375}return a}};var ia={length:0},Xa=function(){var a=+new Date,b;for(b in ia)if(b!="length"&&ia[L](b)){var d=ia[b];if(d.stop){delete ia[b];ia[x]--}else{var f=a-d.start,h= d.ms,e=d.easing,o=d.from,m=d.diff,n=d.to,q=d.t,z=d.prev||0,A=d.el,H=d.callback,R={},F;if(f<h){H=u.easing_formulas[e]?u.easing_formulas[e](f/h):f/h;for(var D in o)if(o[L](D)){switch(v[D]){case "along":F=H*h*m[D];n.back&&(F=n.len-F);e=Aa(n[D],F);A.translate(m.sx-m.x||0,m.sy-m.y||0);m.x=e.x;m.y=e.y;A.translate(e.x-m.sx,e.y-m.sy);n.rot&&A.rotate(m.r+e.alpha,e.x,e.y);break;case "number":F=+o[D]+H*h*m[D];break;case "colour":F="rgb("+[Fa(Z(o[D].r+H*h*m[D].r)),Fa(Z(o[D].g+H*h*m[D].g)),Fa(Z(o[D].b+H*h*m[D].b))][X](",")+ ")";break;case "path":F=[];e=0;for(var G=o[D][x];e<G;e++){F[e]=[o[D][e][0]];for(var T=1,N=o[D][e][x];T<N;T++)F[e][T]=+o[D][e][T]+H*h*m[D][e][T];F[e]=F[e][X](Q)}F=F[X](Q);break;case "csv":switch(D){case "translation":F=m[D][0]*(f-z);e=m[D][1]*(f-z);q.x+=F;q.y+=e;F=F+Q+e;break;case "rotation":F=+o[D][0]+H*h*m[D][0];o[D][1]&&(F+=","+o[D][1]+","+o[D][2]);break;case "scale":F=[+o[D][0]+H*h*m[D][0],+o[D][1]+H*h*m[D][1],2 in n[D]?n[D][2]:"",3 in n[D]?n[D][3]:""][X](Q);break;case "clip-rect":F=[];for(e=4;e--;)F[e]= +o[D][e]+H*h*m[D][e]}}R[D]=F}A.attr(R);A._run&&A._run.call(A)}else{if(n.along){e=Aa(n.along,n.len*!n.back);A.translate(m.sx-(m.x||0)+e.x-m.sx,m.sy-(m.y||0)+e.y-m.sy);n.rot&&A.rotate(m.r+e.alpha,e.x,e.y)}(q.x||q.y)&&A.translate(-q.x,-q.y);n.scale&&(n.scale+="");A.attr(n);delete ia[b];ia[x]--;A.in_animation=null;u.is(H,"function")&&H.call(A)}d.prev=f}}u.svg&&A&&A.paper.safari();ia[x]&&setTimeout(Xa)},Fa=function(a){return a>255?255:a<0?0:a},za=function(a,b){if(a==null)return{x:this._.tx,y:this._.ty, toString:s};this._.tx+=+a;this._.ty+=+b;switch(this.type){case "circle":case "ellipse":this.attr({cx:+a+this.attrs.cx,cy:+b+this.attrs.cy});break;case "rect":case "image":case "text":this.attr({x:+a+this.attrs.x,y:+b+this.attrs.y});break;case "path":var d=qa(this.attrs.path);d[0][1]+=+a;d[0][2]+=+b;this.attr({path:d})}return this};J[B].animateWith=function(a,b,d,f,h){ia[a.id]&&(b.start=ia[a.id].start);return this.animate(b,d,f,h)};J[B].animateAlong=E();J[B].animateAlongBack=E(1);J[B].onAnimation= function(a){this._run=a||0;return this};J[B].animate=function(a,b,d,f){if(u.is(d,"function")||!d)f=d||null;var h={},e={},o={},m;for(m in a)if(a[L](m))if(v[L](m)){h[m]=this.attr(m);h[m]==null&&(h[m]=t[m]);e[m]=a[m];switch(v[m]){case "along":var n=Wa(a[m]),q=Aa(a[m],n*!!a.back),z=this.getBBox();o[m]=n/b;o.tx=z.x;o.ty=z.y;o.sx=q.x;o.sy=q.y;e.rot=a.rot;e.back=a.back;e.len=n;a.rot&&(o.r=c(this.rotate())||0);break;case "number":o[m]=(e[m]-h[m])/b;break;case "colour":h[m]=u.getRGB(h[m]);n=u.getRGB(e[m]); o[m]={r:(n.r-h[m].r)/b,g:(n.g-h[m].g)/b,b:(n.b-h[m].b)/b};break;case "path":n=ja(h[m],e[m]);h[m]=n[0];q=n[1];o[m]=[];n=0;for(z=h[m][x];n<z;n++){o[m][n]=[0];for(var A=1,H=h[m][n][x];A<H;A++)o[m][n][A]=(q[n][A]-h[m][n][A])/b}break;case "csv":q=(a[m]+"").split(g);n=(h[m]+"").split(g);switch(m){case "translation":h[m]=[0,0];o[m]=[q[0]/b,q[1]/b];break;case "rotation":h[m]=n[1]==q[1]&&n[2]==q[2]?n:[0,q[1],q[2]];o[m]=[(q[0]-h[m][0])/b,0,0];break;case "scale":a[m]=q;h[m]=(h[m]+"").split(g);o[m]=[(q[0]-h[m][0])/ b,(q[1]-h[m][1])/b,0,0];break;case "clip-rect":h[m]=(h[m]+"").split(g);o[m]=[];for(n=4;n--;)o[m][n]=(q[n]-h[m][n])/b}e[m]=q}}this.stop();this.in_animation=1;ia[this.id]={start:a.start||+new Date,ms:b,easing:d,from:h,diff:o,to:e,el:this,callback:f,t:{x:0,y:0}};++ia[x]==1&&Xa();return this};J[B].stop=function(){ia[this.id]&&ia[x]--;delete ia[this.id];return this};J[B].translate=function(a,b){return this.attr({translation:a+" "+b})};J[B].toString=function(){return"Rapha\u00ebl\u2019s object"};u.ae=ia; var oa=function(a){this.items=[];this[x]=0;if(a)for(var b=0,d=a[x];b<d;b++)if(a[b]&&(a[b].constructor==J||a[b].constructor==oa)){this[this.items[x]]=this.items[this.items[x]]=a[b];this[x]++}};oa[B][$]=function(){for(var a,b,d=0,f=arguments[x];d<f;d++)if((a=arguments[d])&&(a.constructor==J||a.constructor==oa)){b=this.items[x];this[b]=this.items[b]=a;this[x]++}return this};oa[B].pop=function(){delete this[this[x]--];return this.items.pop()};for(var Ga in J[B])if(J[B][L](Ga))oa[B][Ga]=function(a){return function(){for(var b= 0,d=this.items[x];b<d;b++)this.items[b][a][K](this.items[b],arguments);return this}}(Ga);oa[B].attr=function(a){if(a&&u.is(a,"array")&&u.is(a[0],"object"))for(var b=0,d=a[x];b<d;b++)this.items[b].attr(a[b]);else{b=0;for(d=this.items[x];b<d;b++)this.items[b].attr[K](this.items[b],arguments)}return this};oa[B].animate=function(a,b,d,f){(u.is(d,"function")||!d)&&(f=d||null);var h=this.items[x],e=h,o=this,m;f&&(m=function(){!--h&&f.call(o)});for(this.items[--e].animate(a,b,d||m,m);e--;)this.items[e].animateWith(this.items[h- 1],a,b,d||m,m);return this};oa[B].insertAfter=function(a){for(var b=this.items[x];b--;)this.items[b].insertAfter(a);return this};oa[B].getBBox=function(){for(var a=[],b=[],d=[],f=[],h=this.items[x];h--;){var e=this.items[h].getBBox();a[$](e.x);b[$](e.y);d[$](e.x+e.width);f[$](e.y+e.height)}a=ka[K](0,a);b=ka[K](0,b);return{x:a,y:b,width:ea[K](0,d)-a,height:ea[K](0,f)-b}};u.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},d=a.face["font-family"], f;for(f in a.face)if(a.face[L](f))b.face[f]=a.face[f];if(this.fonts[d])this.fonts[d][$](b);else this.fonts[d]=[b];if(!a.svg){b.face["units-per-em"]=k(a.face["units-per-em"],10);for(var h in a.glyphs)if(a.glyphs[L](h)){d=a.glyphs[h];b.glyphs[h]={w:d.w,k:{},d:d.d&&"M"+d.d.replace(/[mlcxtrv]/g,function(o){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[o]||"M"})+"z"};if(d.k)for(var e in d.k)if(d[L](e))b.glyphs[h].k[e]=d.k[e]}}return a};I[B].getFont=function(a,b,d,f){f=f||"normal";d=d||"normal";b=+b||{normal:400, bold:700,lighter:300,bolder:800}[b]||400;var h=u.fonts[a];if(!h){a=RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,"")+"(\\s|$)","i");for(var e in u.fonts)if(u.fonts[L](e))if(a.test(e)){h=u.fonts[e];break}}var o;if(h){e=0;for(a=h[x];e<a;e++){o=h[e];if(o.face["font-weight"]==b&&(o.face["font-style"]==d||!o.face["font-style"])&&o.face["font-stretch"]==f)break}}return o};I[B].print=function(a,b,d,f,h,e){e=e||"middle";var o=this.set();d=(d+"").split("");var m=0;u.is(f,"string")&&(f=this.getFont(f));if(f){h= (h||16)/f.face["units-per-em"];var n=f.face.bbox.split(g),q=+n[0];e=+n[1]+(e=="baseline"?n[3]-n[1]+ +f.face.descent:(n[3]-n[1])/2);n=0;for(var z=d[x];n<z;n++){var A=n&&f.glyphs[d[n-1]]||{},H=f.glyphs[d[n]];m+=n?(A.w||f.w)+(A.k&&A.k[d[n]]||0):0;H&&H.d&&o[$](this.path(H.d).attr({fill:"#000",stroke:"none",translation:[m,0]}))}o.scale(h,h,q,e).translate(a-q,b-e)}return o};u.format=function(a){var b=u.is(arguments[1],"array")?[0].concat(arguments[1]):arguments,d=/\{(\d+)\}/g;a&&u.is(a,"string")&&b[x]- 1&&(a=a.replace(d,function(f,h){return b[++h]==null?"":b[h]}));return a||""};u.ninja=function(){var a;if(w.was)Raphael=w.is;else delete Raphael;return Raphael};u.el=J[B];return u}();if(!this.JSON)this.JSON={}; (function(){function C(I){return I<10?"0"+I:I}function s(I){i.lastIndex=0;return i.test(I)?'"'+I.replace(i,function(K){var Q=w[K];return typeof Q==="string"?Q:"\\u"+("0000"+K.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+I+'"'}function E(I,K){var Q,Y,L,X,x=j,B,S=K[I];if(S&&typeof S==="object"&&typeof S.toJSON==="function")S=S.toJSON(I);if(typeof u==="function")S=u.call(K,I,S);switch(typeof S){case "string":return s(S);case "number":return isFinite(S)?String(S):"null";case "boolean":case "null":return String(S); case "object":if(!S)return"null";j+=r;B=[];if(Object.prototype.toString.apply(S)==="[object Array]"){X=S.length;for(Q=0;Q<X;Q+=1)B[Q]=E(Q,S)||"null";L=B.length===0?"[]":j?"[\n"+j+B.join(",\n"+j)+"\n"+x+"]":"["+B.join(",")+"]";j=x;return L}if(u&&typeof u==="object"){X=u.length;for(Q=0;Q<X;Q+=1){Y=u[Q];if(typeof Y==="string")if(L=E(Y,S))B.push(s(Y)+(j?": ":":")+L)}}else for(Y in S)if(Object.hasOwnProperty.call(S,Y))if(L=E(Y,S))B.push(s(Y)+(j?": ":":")+L);L=B.length===0?"{}":j?"{\n"+j+B.join(",\n"+j)+ "\n"+x+"}":"{"+B.join(",")+"}";j=x;return L}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+C(this.getUTCMonth()+1)+"-"+C(this.getUTCDate())+"T"+C(this.getUTCHours())+":"+C(this.getUTCMinutes())+":"+C(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var g=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j,r,w={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},u;if(typeof JSON.stringify!=="function")JSON.stringify=function(I,K,Q){var Y;r=j="";if(typeof Q==="number")for(Y=0;Y<Q;Y+=1)r+=" ";else if(typeof Q==="string")r=Q;if((u=K)&&typeof K!=="function"&&(typeof K!=="object"||typeof K.length!=="number"))throw Error("JSON.stringify");return E("", {"":I})};if(typeof JSON.parse!=="function")JSON.parse=function(I,K){function Q(L,X){var x,B,S=L[X];if(S&&typeof S==="object")for(x in S)if(Object.hasOwnProperty.call(S,x)){B=Q(S,x);if(B!==undefined)S[x]=B;else delete S[x]}return K.call(L,X,S)}var Y;I=String(I);g.lastIndex=0;if(g.test(I))I=I.replace(g,function(L){return"\\u"+("0000"+L.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(I.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){Y=eval("("+I+")");return typeof K==="function"?Q({"":Y},""):Y}throw new SyntaxError("JSON.parse");}})();(function(C){function s(c,k,p){if(!(this instanceof s))return new s(c,k,p);this.paper=s.paper();this._registeredObjects=[];this._conVerticesCurrentIndex=0;this._nearbyVertexSqrDist=500;this.dom={};this._start={shape:null,dummy:false};this._end={shape:null,dummy:false};this._callbacks={justConnected:function(){},disconnected:function(){},justBroken:function(){},wiring:function(){},objectMoving:function(){}};this._opt={vertices:[],attrs:{stroke:"#000","fill-opacity":0,"stroke-width":1,"stroke-dasharray":"-", "stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":1,"stroke-opacity":1},cursor:"move",beSmooth:false,interactive:true,label:undefined,labelAttrsDefault:{position:0.5,offset:0,"font-size":12,fill:"#000"},labelAttrs:[],labelBoxAttrsDefault:{stroke:"white",fill:"white"},labelBoxAttrs:[],bboxCorrection:{start:{type:null,x:0,y:0,width:0,height:0},end:{type:null,x:0,y:0,width:0,height:0}},dummy:{start:{radius:1,attrs:{opacity:0,fill:"red"}},end:{radius:1,attrs:{opacity:0,fill:"yellow"}}}, handle:{timeout:2E3,start:{enabled:false,radius:4,attrs:{opacity:1,fill:"red",stroke:"black"}},end:{enabled:false,radius:4,attrs:{opacity:1,fill:"red",stroke:"black"}}}};this._opt.arrow={start:s.getArrow("none",2,this._opt.attrs),end:s.getArrow("basic",5)};p&&this.processOptions(p);ta.init(this.paper,this._opt,this._start,this._end);p=this._start;var t=this._end;if(c.x&&c.y)ta.dummy(p,c,this._opt.dummy.start);else p.shape=c.yourself();if(k.x&&k.y)ta.dummy(t,k,this._opt.dummy.end);else t.shape=k.yourself(); this.addJoint(p.shape);this.addJoint(t.shape);this.update()}function E(c,k){var p;if(k===undefined){p=c.split(c.indexOf("@")===-1?" ":"@");this.x=parseInt(p[0],10);this.y=parseInt(p[1],10)}else{this.x=c;this.y=k}}function g(c,k){return new E(c,k)}function i(c,k){this.start=c;this.end=k}function j(c,k){return new i(c,k)}function r(c){this.x=c.x;this.y=c.y;this.width=c.width;this.height=c.height}function w(c,k,p,t){if(typeof c.width==="undefined")return new r({x:c,y:k,width:p,height:t});return new r(c)} function u(c,k,p){this.x=c.x;this.y=c.y;this.a=k;this.b=p}function I(c,k,p){return new u(c,k,p)}function K(c,k,p,t){this.p0=c;this.p1=k;this.p2=p;this.p3=t}function Q(c,k,p,t){return new K(c,k,p,t)}function Y(){}var L=C.Math,X=L.cos,x=L.sin,B=L.sqrt,S=L.min,M=L.max,ea=L.atan2,ka=L.acos,ca=L.PI,sa=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"};if(!C.console)C.console={log:function(){},warn:function(){},error:function(){},debug:function(){}};if(!Array.indexOf)Array.prototype.indexOf= function(c,k){for(var p=k||0,t=this.length;p<t;p++)if(this[p]==c)return p;return-1};var U=function(){for(var c=arguments[0],k=1,p=arguments.length;k<p;k++){var t=arguments[k],v;for(v in t)if(t.hasOwnProperty(v)){var y=t[v];if(y!==c[v]){if(typeof y=="function"&&typeof c[v]=="function"&&!y.base)y.base=c[v];c[v]=y}}}return c},$=function(){for(var c=arguments[0],k=1,p=arguments.length;k<p;k++){var t=arguments[k],v;for(v in t){var y=t[v];if(y!==c[v]){if(typeof y=="function"&&typeof c[v]=="function"&&!c[v].base)c[v].base= y;if(!c.hasOwnProperty(v)&&t.hasOwnProperty(v))c[v]=y}}}return c},pa=function(){for(var c=arguments[0],k=1,p=arguments.length;k<p;k++){var t=arguments[k],v;for(v in t){var y=t[v];if(y!==c[v]){if(Object.prototype.toString.call(y)==="[object Object]")pa(c[v]||(c[v]={}),y);if(typeof y=="function"&&typeof c[v]=="function"&&!c[v].base)c[v].base=y;c[v]=y}}}return c},wa=function(){for(var c=arguments[0],k=1,p=arguments.length;k<p;k++){var t=arguments[k],v;for(v in t){var y=t[v];if(y!==c[v]){if(Object.prototype.toString.call(y)=== "[object Object]")wa(c[v]||(c[v]={}),y);if(typeof y=="function"&&typeof c[v]=="function"&&!c[v].base)c[v].base=y;if(!c.hasOwnProperty(v)&&t.hasOwnProperty(v))c[v]=y}}}return c};C.Joint=s;s.euid=1;s.generateEuid=function(){if(this._euid===undefined)this._euid=s.euid++;return this._euid};s.prototype={_dx:undefined,_dy:undefined,IDLE:0,STARTCAPDRAGGING:1,ENDCAPDRAGGING:2,CONNECTIONWIRING:3,state:0,euid:function(){return s.generateEuid.call(this)},connection:function(){return this.dom.connection[0]}, endObject:function(){return this._end.shape},startObject:function(){return this._start.shape},endCap:function(){return this.dom.endCap},endCapConnected:function(){return!this._end.dummy},startCap:function(){return this.dom.startCap},startCapConnected:function(){return!this._start.dummy},isStartDummy:function(){return this._start.dummy},isEndDummy:function(){return this._end.dummy},replaceDummy:function(c,k){c.shape.remove();c.dummy=false;c.shape=k},callback:function(c,k,p){this._callbacks[c].apply(k, p);return this},objectContainingPoint:function(c){for(var k=this._registeredObjects,p=k?k.length:0,t;p--;){t=k[p].yourself();if(w(t.getBBox()).containsPoint(c))return t}return null},freeJoint:function(c){c=c.yourself().joints();var k=c.indexOf(this);c.splice(k,1);return this},addJoint:function(c){c=c.joints();c.indexOf(this)===-1&&c.push(this)},capMouseDown:function(c,k){s.currentJoint=this;this._dx=c.clientX;this._dy=c.clientY;if(k===this.dom.startCap){this.disconnect("start");this.state=this.STARTCAPDRAGGING}else if(k=== this.dom.endCap){this.disconnect("end");this.state=this.ENDCAPDRAGGING}},connectionMouseDown:function(c){s.currentJoint=this;c=s.getMousePosition(c,this.paper);for(var k=0,p=this._opt.vertices.length;k<p;k++)if(j(this._opt.vertices[k],c).squaredLength()<this._nearbyVertexSqrDist){this._conVerticesCurrentIndex=k;this.state=this.CONNECTIONWIRING;return}p=w(this.startObject().getBBox()).center();k=w(this.endObject().getBBox()).center();p=j(p,c).squaredLength();k=j(k,c).squaredLength();if(p<k){this._conVerticesCurrentIndex= 0;this._opt.vertices.unshift(c)}else this._conVerticesCurrentIndex=this._opt.vertices.push(c)-1;this.state=this.CONNECTIONWIRING;this.callback("justBroken",this,[c])},capDragging:function(c){if(this.state===this.STARTCAPDRAGGING)this.startObject().translate(c.clientX-this._dx,c.clientY-this._dy);else if(this.state===this.ENDCAPDRAGGING)this.endObject().translate(c.clientX-this._dx,c.clientY-this._dy);else return;this._dx=c.clientX;this._dy=c.clientY;this.update()},capEndDragging:function(){var c, k=this.state===this.STARTCAPDRAGGING,p=this.state===this.ENDCAPDRAGGING,t=k?"start":"end";if(k)c=this.startObject().getBBox();else if(p)c=this.endObject().getBBox();if(c=this.objectContainingPoint(g(c.x,c.y))){this.callback("justConnected",c,[t]);this.replaceDummy(this["_"+t],c);this.addJoint(c)}this.update()},connectionWiring:function(c){c=s.getMousePosition(c,this.paper);this._opt.vertices[this._conVerticesCurrentIndex]=c;this.update();this.callback("wiring",this,[c])},update:function(){this.redraw().listenAll()}, redraw:function(){this.clean(["connection","startCap","endCap","handleStart","handleEnd","label"]);this.draw(["connection","startCap","endCap","handleStart","handleEnd","label"]);return this},listenAll:function(){if(!this._opt.interactive)return this;var c=this;this.dom.startCap.mousedown(function(p){s.fixEvent(p);c.capMouseDown(p,c.dom.startCap);p.stopPropagation();p.preventDefault()});this.dom.endCap.mousedown(function(p){s.fixEvent(p);c.capMouseDown(p,c.dom.endCap);p.stopPropagation();p.preventDefault()}); var k;for(k=this.dom.connection.length;k--;)this.dom.connection[k].mousedown(function(p){s.fixEvent(p);c.connectionMouseDown(p);p.stopPropagation();p.preventDefault()});this._opt.handle.start.enabled&&this.dom.handleStart.mousedown(function(p){s.fixEvent(p);c.capMouseDown(p,c.dom.startCap);p.stopPropagation();p.preventDefault()});this._opt.handle.end.enabled&&this.dom.handleEnd.mousedown(function(p){s.fixEvent(p);c.capMouseDown(p,c.dom.endCap);p.stopPropagation();p.preventDefault()});if(this._opt.handle.timeout!== Infinity)for(k=this.dom.connection.length;k--;)this.dom.connection[k].mouseover(function(p){s.fixEvent(p);c.showHandle();setTimeout(function(){c.hideHandle()},c._opt.handle.timeout);p.stopPropagation();p.preventDefault()});return this},boundPoint:function(c,k,p,t){if(k==="circle"||k==="ellipse")return I(c.center(),c.width/2,c.height/2).intersectionWithLineFromCenterToPoint(t);else if(k==="rect"&&c.width==c.height&&p!=0){k=c.width;k=Math.sqrt(k*k+k*k);c=c.center().offset(-k/2,-k/2);c=w(c.x,c.y,k,k)}return c.boundPoint(t)|| c.center()},jointLocation:function(c,k,p){var t=p.length,v;v=p.length?p[0]:undefined;var y=p.length?p[t-1]:undefined,O,aa,V;p=this.boundPoint(c.bbox,c.type,c.rotation,v||k.bbox.center());v=c.bbox.center().theta(v||k.bbox.center());t=g(p.x+2*c.shift.dx*X(v.radians),p.y+-2*c.shift.dy*x(v.radians));O=g(p.x+c.shift.dx*X(v.radians),p.y-c.shift.dy*x(v.radians));aa=360-v.degrees+180;V=this.boundPoint(k.bbox,k.type,k.rotation,y||c.bbox.center());v=(y||c.bbox.center()).theta(k.bbox.center());c=g(V.x+-2*k.shift.dx* X(v.radians),V.y+2*k.shift.dy*x(v.radians));k=g(V.x-k.shift.dx*X(v.radians),V.y+k.shift.dy*x(v.radians));return{start:{bound:p,connection:t,translate:O,rotate:aa},end:{bound:V,connection:c,translate:k,rotate:360-v.degrees}}},connectionPathCommands:function(c,k,p,t){if(t)return Y.curveThroughPoints([c].concat(p,[k]));c=["M",c.x,c.y];t=0;for(var v=p.length;t<v;t++)c.push("L",p[t].x,p[t].y);c.push("L",k.x,k.y);return c},labelLocation:function(c){c=this.paper.path(c.join(" "));for(var k=c.getTotalLength(), p=[],t=this._opt.labelAttrs,v=t.length,y=0,O;y<v;y++){O=t[y].position;O=O>k?k:O;O=O<0?k+O:O;O=O>1?O:k*O;p.push(c.getPointAtLength(O))}c.remove();return p},draw:function(c){var k=this.jointLocation({bbox:w(this.startObject().getBBox()).moveAndExpand(this._opt.bboxCorrection.start),type:this.startObject().type,rotation:this.startObject().attrs.rotation,shift:this._opt.arrow.start},{bbox:w(this.endObject().getBBox()).moveAndExpand(this._opt.bboxCorrection.end),type:this.endObject().type,rotation:this.endObject().attrs.rotation, shift:this._opt.arrow.end},this._opt.vertices),p=this.connectionPathCommands(k.start.connection,k.end.connection,this._opt.vertices,this._opt.beSmooth),t=this.labelLocation(p);k=ta.init(this.paper,this._opt,this._start,this._end,k,p,t);p=c.length;for(var v=0;v<p;v++){t=c[v];this.dom[t]=k[t]()}},clean:function(c){for(var k,p,t=c.length;t--;){p=c[t];if(k=this.dom[p]){if(k.node){k.remove();this.dom[p]=null}else for(var v in k)k.hasOwnProperty(v)&&k[v].remove();this.dom[p]=null}}},processOptions:function(c){for(var k= this._opt,p=["interactive","cursor","beSmooth"],t=p.length;t--;)if(c[p[t]]!==undefined)k[p[t]]=c[p[t]];k.subConnectionAttrs=c.subConnectionAttrs||undefined;U(k.attrs,c.attrs);U(k.bboxCorrection.start,c.bboxCorrection&&c.bboxCorrection.start);U(k.bboxCorrection.end,c.bboxCorrection&&c.bboxCorrection.end);c.vertices&&this._setVertices(c.vertices);if(c.label){k.label=sa(c.label)?c.label:[c.label];if(!sa(c.labelAttrs))c.labelAttrs=[c.labelAttrs];for(t=0;t<k.label.length;t++)$(c.labelAttrs[t]||(c.labelAttrs[t]= {}),k.labelAttrsDefault);k.labelAttrs=c.labelAttrs;p=undefined;if(!sa(c.labelBoxAttrs)){if(typeof c.labelBoxAttrs==="object")p=c.labelBoxAttrs;c.labelBoxAttrs=[c.labelBoxAttrs]}for(t=0;t<k.label.length;t++){if(p)c.labelBoxAttrs[t]=p;$(c.labelBoxAttrs[t]||(c.labelBoxAttrs[t]={}),this._opt.labelBoxAttrsDefault)}k.labelBoxAttrs=c.labelBoxAttrs}t=c.startArrow;p=c.endArrow;if(t&&t.type)k.arrow.start=s.getArrow(t.type,t.size,t.attrs);if(p&&p.type)k.arrow.end=s.getArrow(p.type,p.size,p.attrs);if(c.arrow){k.arrow.start= c.arrow.start||k.arrow.start;k.arrow.end=c.arrow.end||k.arrow.end}if(c.dummy&&c.dummy.start){if(c.dummy.start.radius)k.dummy.start.radius=c.dummy.start.radius;U(k.dummy.start.attrs,c.dummy.start.attrs)}if(c.dummy&&c.dummy.end){if(c.dummy.end.radius)k.dummy.end.radius=c.dummy.end.radius;U(k.dummy.end.attrs,c.dummy.end.attrs)}if(c.handle){if(c.handle.timeout)k.handle.timeout=c.handle.timeout;if(c.handle.start){if(c.handle.start.enabled)k.handle.start.enabled=c.handle.start.enabled;if(c.handle.start.radius)k.handle.start.radius= c.handle.start.radius;U(k.handle.start.attrs,c.handle.start.attrs)}if(c.handle.end){if(c.handle.end.enabled)k.handle.end.enabled=c.handle.end.enabled;if(c.handle.end.radius)k.handle.end.radius=c.handle.end.radius;U(k.handle.end.attrs,c.handle.end.attrs)}}},disconnect:function(c){var k,p=c==="start"?"Start":c==="end"?"End":"Both";if(c==="both"||c===undefined){this.freeJoint(this.startObject()).freeJoint(this.endObject());if(!this.isStartDummy()){k=this.startObject();this.draw(["dummyStart"]);this.callback("disconnected", k,[c])}if(!this.isEndDummy()){k=this.endObject();this.draw(["dummyEnd"]);this.callback("disconnected",k,[c])}}else if(!this["is"+p+"Dummy"]()){k=this[c+"Object"]();this.startObject()!==this.endObject()&&this.freeJoint(k);this.draw(["dummy"+p]);this.callback("disconnected",k,[c])}return this},register:function(c,k){k||(k="both");for(var p=c.constructor==Array?c:[c],t=0,v=p.length;t<v;t++){p[t].yourself()._capToStick=k;this._registeredObjects.push(p[t])}return this},registerForever:function(c){if(Object.prototype.toString.call(c)!== "[object Array]")c=Array.prototype.slice.call(arguments);this._registeredObjects=c;return this},unregister:function(c,k){k=k||"both";for(var p=-1,t=0,v=this._registeredObjects.length;t<v;t++){var y=this._registeredObjects[t].yourself()._capToStick||"both";if(this._registeredObjects[t]===c&&y===k){p=t;break}}p!==-1&&this._registeredObjects.splice(p,1);return this},registeredObjects:function(){return this._registeredObjects},setVertices:function(c){this._setVertices(c);this.update();return this},_setVertices:function(c){for(var k= this._opt.vertices=[],p,t=0,v=c.length;t<v;t++){p=c[t].y===undefined?g(c[t]):g(c[t].x,c[t].y);k.push(p)}return this},getVertices:function(){return this._opt.vertices},toggleSmoothing:function(){this._opt.beSmooth=!this._opt.beSmooth;this.update();return this},isSmooth:function(){return this._opt.beSmooth},label:function(c){this._opt.label=sa(c)?c:[c];for(var k=0;k<c.length;k++){this._opt.labelAttrs[k]=this._opt.labelAttrsDefault;this._opt.labelBoxAttrs[k]=this._opt.labelBoxAttrsDefault}this.update(); return this},registerCallback:function(c,k){this._callbacks[c]=k;return this},straighten:function(){this._opt.vertices=[];this.update();return this},toggleHandle:function(c){var k=this._opt.handle;if(c)k[c].enabled=!k[c].enabled;else{k.start.enabled=!k.start.enabled;k.end.enabled=!k.end.enabled}this.update();return this},showHandle:function(c){var k=this._opt.handle;if(c)k[c].enabled=true;else{k.start.enabled=true;k.end.enabled=true}this.update();return this},hideHandle:function(c){var k=this._opt.handle; if(c)k[c].enabled=false;else{k.start.enabled=false;k.end.enabled=false}this.update();return this},setBBoxCorrection:function(c,k){if(k)this._opt.bboxCorrection[k]=c;else this._opt.bboxCorrection.start=this._opt.bboxCorrection.end=c;this.update();return this},highlight:function(c){this.connection().attr("stroke",c||"red");return this},unhighlight:function(){this.connection().attr("stroke",this._opt.attrs.stroke||"#000");return this}};s.currentJoint=null;s.paper=function(){var c=arguments[0];if(c=== undefined)return this._paper;this._paperArguments=arguments;if(!(c instanceof C.Raphael))return this._paper=C.Raphael.apply(C,arguments);return this._paper=c};s.resetPaper=function(){if(this._paper){var c=this._paper.canvas;c.parentNode.removeChild(c);s.paper.apply(s,this._paperArguments)}};s.getArrow=function(c,k,p){k||(k=2);c=s.arrows[c](k);if(!c.attrs)c.attrs={};if(p)for(var t in p)c.attrs[t]=p[t];return c};s.arrows={none:function(c){c||(c=2);return{path:["M",c.toString(),"0","L",(-c).toString(), "0"],dx:c,dy:c,attrs:{opacity:0}}},basic:function(c){c||(c=5);return{path:["M",c.toString(),"0","L",(-c).toString(),(-c).toString(),"L",(-c).toString(),c.toString(),"z"],dx:c,dy:c,attrs:{stroke:"black",fill:"black"}}}};s.getMousePosition=function(c,k){if(window.event&&window.event.contentOverflow!==undefined)return g(window.event.x,window.event.y);if(c.offsetX!==undefined&&c.offsetY!==undefined)return g(c.offsetX,c.offsetY);var p=k.canvas.parentNode,t=p.offsetParent,v=c.pageX-p.offsetLeft;for(p=c.pageY- p.offsetTop;t;){v+=t.offsetLeft;p+=t.offsetTop;t=t.offsetParent}return g(v,p)};s.mouseMove=function(c){if(s.currentJoint!==null){var k=s.currentJoint;if(k.state===k.STARTCAPDRAGGING||k.state===k.ENDCAPDRAGGING)k.capDragging(c);else k.state===k.CONNECTIONWIRING&&k.connectionWiring(c)}};s.mouseUp=function(){if(s.currentJoint!==null){var c=s.currentJoint;if(c.state===c.STARTCAPDRAGGING||c.state===c.ENDCAPDRAGGING)c.capEndDragging()}s.currentJoint=null};s.fixEvent=function(c){c.preventDefault=s.fixEvent.preventDefault; c.stopPropagation=s.fixEvent.stopPropagation;return c};s.fixEvent.preventDefault=function(){this.returnValue=false};s.fixEvent.stopPropagation=function(){this.cancelBubble=true};s.handleEvent=function(c){var k=true;c=c||s.fixEvent(((C.ownerDocument||C.document||C).parentWindow||C).event);var p=this.events[c.type],t;for(t in p){this.$$handleEvent=p[t];if(this.$$handleEvent(c)===false)k=false}return k};s.addEvent=function(c,k,p){if(c.addEventListener)c.addEventListener(k,p,false);else{if(!p.$$guid)p.$$guid= s.addEvent.guid++;if(!c.events)c.events={};var t=c.events[k];if(!t){t=c.events[k]={};if(c["on"+k])t[0]=c["on"+k]}t[p.$$guid]=p;c["on"+k]=s.handleEvent}};s.addEvent.guid=1;s.removeEvent=function(c,k,p){if(c.removeEventListener)c.removeEventListener(k,p,false);else c.events&&c.events[k]&&delete c.events[k][p.$$guid]};s.addEvent(document,"mousemove",s.mouseMove);s.addEvent(document,"mouseup",s.mouseUp);var ta={init:function(c,k,p,t,v,y,O){this.paper=c;this.opt=k;this.start=p;this.end=t;this.jointLocation= v;this.connectionPathCommands=y;this.labelLocation=O;return this},dummy:function(c,k,p){c.dummy=true;c.shape=this.paper.circle(k.x,k.y,p.radius).attr(p.attrs);c.shape.show();return c.shape},dummyStart:function(){return this.dummy(this.start,this.jointLocation.start.bound,this.opt.dummy.start)},dummyEnd:function(){return this.dummy(this.end,this.jointLocation.end.bound,this.opt.dummy.end)},handleStart:function(){var c=this.opt.handle.start;if(c.enabled){var k=this.jointLocation.start.bound;return this.paper.circle(k.x, k.y,c.radius).attr(c.attrs)}},handleEnd:function(){var c=this.opt.handle.end;if(c.enabled){var k=this.jointLocation.end.bound;return this.paper.circle(k.x,k.y,c.radius).attr(c.attrs)}},connection:function(){var c=this.opt,k=[],p=this.paper.path(this.connectionPathCommands.join(" ")).attr(c.attrs);if(c.subConnectionAttrs)for(var t=0,v=c.subConnectionAttrs.length,y=p.getTotalLength();t<v;t++){var O=c.subConnectionAttrs[t],aa=O.from||2,V=O.to||1;aa=aa>y?y:aa;aa=aa<0?y+aa:aa;aa=aa>1?aa:y*aa;V=V>y?y:V; V=V<0?y+V:V;V=V>1?V:y*V;O=this.paper.path(p.getSubpath(aa,V)).attr(O);O.node.style.cursor=c.cursor;k.push(O)}p.node.style.cursor=c.cursor;p.show();return[p].concat(k)},label:function(){if(this.opt.label!==undefined){for(var c=sa(this.opt.label)?this.opt.label:[this.opt.label],k=this.opt.labelAttrs,p=c.length,t=0,v=[];t<p;t++){var y=this.labelLocation[t];y=this.paper.text(y.x,y.y+(k[t].offset||0),c[t]).attr(k[t]);var O=y.getBBox(),aa=k[t].padding||0;O=this.paper.rect(O.x-aa,O.y-aa+(k[t].offset||0), O.width+2*aa,O.height+2*aa).attr(this.opt.labelBoxAttrs[t]);y.insertAfter(O);v.push(y,O)}return v}},startCap:function(){var c=this.opt.arrow.start;c=this.paper.path(c.path.join(" ")).attr(c.attrs);c.translate(this.jointLocation.start.translate.x,this.jointLocation.start.translate.y);c.rotate(this.jointLocation.start.rotate);c.show();return c},endCap:function(){var c=this.opt.arrow.end;c=this.paper.path(c.path.join(" ")).attr(c.attrs);c.translate(this.jointLocation.end.translate.x,this.jointLocation.end.translate.y); c.rotate(this.jointLocation.end.rotate);c.show();return c}};E.prototype={constructor:E,_isPoint:true,toString:function(){return this.x+"@"+this.y},deepCopy:function(){return g(this.x,this.y)},adhereToRect:function(c){if(c.containsPoint(this))return this;this.x=S(M(this.x,c.x),c.x+c.width);this.y=S(M(this.y,c.y),c.y+c.height);return this},theta:function(c){c=ea(-(c.y-this.y),c.x-this.x);if(c<0)c=2*ca+c;return{degrees:180*c/ca,radians:c}},distance:function(c){return j(this,c).length()},offset:function(c, k){this.x+=c;this.y+=k;return this},normalize:function(c){c/=B(this.x*this.x+this.y*this.y);this.x*=c;this.y*=c;return this}};E.fromPolar=function(c,k){return g(c*X(k),c*x(k))};i.prototype={constructor:i,toString:function(){return"start: "+this.start.toString()+" end:"+this.end.toString()},length:function(){return B(this.squaredLength())},squaredLength:function(){var c=this.start.x,k=this.start.y,p=this.end.y;return(c-=this.end.x)*c+(k-=p)*k},midpoint:function(){return g((this.start.x+this.end.x)/ 2,(this.start.y+this.end.y)/2)},intersection:function(c){var k=g(this.end.x-this.start.x,this.end.y-this.start.y),p=g(c.end.x-c.start.x,c.end.y-c.start.y),t=k.x*p.y-k.y*p.x;c=g(c.start.x-this.start.x,c.start.y-this.start.y);p=c.x*p.y-c.y*p.x;c=c.x*k.y-c.y*k.x;if(t===0||p*t<0||c*t<0)return null;if(t>0){if(p>t||c>t)return null}else if(p<t||c<t)return null;return g(this.start.x+p*k.x/t,this.start.y+p*k.y/t)}};r.prototype={constructor:r,toString:function(){return"origin: "+this.origin().toString()+" corner: "+ this.corner().toString()},origin:function(){return g(this.x,this.y)},corner:function(){return g(this.x+this.width,this.y+this.height)},topRight:function(){return g(this.x+this.width,this.y)},bottomLeft:function(){return g(this.x,this.y+this.height)},center:function(){return g(this.x+this.width/2,this.y+this.height/2)},intersect:function(c){var k=this.origin(),p=this.corner(),t=c.origin();c=c.corner();if(c.x<=k.x)return false;if(c.y<=k.y)return false;if(t.x>=p.x)return false;if(t.y>=p.y)return false; return true},sideNearestToPoint:function(c){var k=this.x+this.width-c.x,p=c.y-this.y,t=this.y+this.height-c.y;c=c.x-this.x;var v="left";if(k<c){c=k;v="right"}if(p<c){c=p;v="top"}if(t<c)v="bottom";return v},containsPoint:function(c){if(c.x>this.x&&c.x<this.x+this.width&&c.y>this.y&&c.y<this.y+this.height)return true;return false},pointNearestToPoint:function(c){if(this.containsPoint(c))switch(this.sideNearestToPoint(c)){case "right":return g(this.x+this.width,c.y);case "left":return g(this.x,c.y); case "bottom":return g(c.x,this.y+this.height);case "top":return g(c.x,this.y)}else return c.adhereToRect(this)},boundPoint:function(c){var k=g(this.x+this.width/2,this.y+this.height/2),p=[j(this.origin(),this.topRight()),j(this.topRight(),this.corner()),j(this.corner(),this.bottomLeft()),j(this.bottomLeft(),this.origin())];c=j(k,c);for(k=p.length-1;k>=0;--k){var t=p[k].intersection(c);if(t!==null)return t}},moveAndExpand:function(c){this.x+=c.x;this.y+=c.y;this.width+=c.width;this.height+=c.height; return this}};u.prototype={constructor:u,bbox:function(){return w({x:this.x-this.a,y:this.y-this.b,width:2*this.a,height:2*this.b})},intersectionWithLineFromCenterToPoint:function(c){var k=c.x-this.x,p=c.y-this.y;if(k===0)return this.bbox().pointNearestToPoint(c);c=p/k;p=B(1/(1/(this.a*this.a)+c*c/(this.b*this.b)));if(k<0)p=-p;return g(this.x+p,this.y+c*p)}};K.prototype={constructor:K,getPoint:function(c){var k=1-c,p=k*k,t=p*k,v=c*c,y=v*c;return g(t*this.p0.x+3*p*c*this.p1.x+3*k*v*this.p2.x+y*this.p3.x, t*this.p0.y+3*p*c*this.p1.y+3*k*v*this.p2.y+y*this.p3.y)}};Y.curveThroughPoints=function(c,k,p){if(typeof k==="undefined")k=0.5;if(typeof p==="undefined")p=0.75;var t=[];if(c.length<2)throw Error("Points array must have minimum of two points.");for(var v=[c[0]],y=1,O=c.length;y<O;y++)if(c[y].x!=c[y-1].x||c[y].y!=c[y-1].y)v.push(c[y]);if(k<=0)k=0.5;else if(k>1)k=1;if(p<0)p=0;else if(p>1)p=1;if(v.length>2){var aa=1;c=v.length-1;if(v[0].x==v[c].x&&v[0].y==v[c].y){aa=0;c=v.length}O=[];for(y=aa;y<c;y++){var V= y-1<0?v[v.length-2]:v[y-1],da=v[y],qa=y+1==v.length?v[1]:v[y+1],ba=V.distance(da);if(ba<0.0010)ba=0.0010;var ha=da.distance(qa);if(ha<0.0010)ha=0.0010;var ga=V.distance(qa);if(ga<0.0010)ga=0.0010;ga=(ha*ha+ba*ba-ga*ga)/(2*ha*ba);if(ga<-1)ga=-1;else if(ga>1)ga=1;ga=ka(ga);var la=g(V.x-da.x,V.y-da.y),na=g(da.x,da.y),ja=g(qa.x-da.x,qa.y-da.y);if(ba>ha)la.normalize(ha);else ha>ba&&ja.normalize(ba);la.offset(da.x,da.y);ja.offset(da.x,da.y);V=na.x-la.x;la=na.y-la.y;var ua=na.x-ja.x;na=na.y-ja.y;ja=V+ua; var ra=la+na;if(ja===0&&ra===0){ja=-ua;ra=na}if(la===0&&na===0){ja=0;ra=1}else if(V===0&&ua===0){ja=1;ra=0}V=ea(ra,ja);ba=S(ba,ha)*k;ba*=1-p+p*(ga/ca);ga=V+ca/2;ha=E.fromPolar(ba,ga);ba=E.fromPolar(ba,ga+ca);ba.offset(da.x,da.y);ha.offset(da.x,da.y);O[y]=ha.distance(qa)>ba.distance(qa)?[ha,ba]:[ba,ha]}t.push("M",v[0].x,v[0].y);aa==1&&t.push("S",O[1][0].x,O[1][0].y,v[1].x,v[1].y);for(y=aa;y<c-1;y++){k=false;if(y>0&&ea(v[y].y-v[y-1].y,v[y].x-v[y-1].x)==ea(v[y+1].y-v[y].y,v[y+1].x-v[y].x)||y<v.length- 2&&ea(v[y+2].y-v[y+1].y,v[y+2].x-v[y+1].x)==ea(v[y+1].y-v[y].y,v[y+1].x-v[y].x))k=true;if(k)t.push("L",v[y+1].x,v[y+1].y);else{k=Q(v[y],O[y][1],O[y+1][0],v[y+1]);for(p=0.01;p<1.01;p+=0.01){aa=k.getPoint(p);t.push("L",aa.x,aa.y)}}}c==v.length-1&&t.push("S",O[y][1].x,O[y][1].y,v[y+1].x,v[y+1].y)}else if(v.length==2){t.push("M",v[0].x,v[0].y);t.push("L",v[1].x,v[1].y)}return t};s.Point=E;s.point=g;s.Rect=r;s.rect=w;s.Line=i;s.line=j;s.Ellipse=u;s.ellipse=I;s.BezierSegment=K;s.bezierSegment=Q;s.Bezier= Y;s.Mixin=U;s.Supplement=$;s.DeepMixin=pa;s.DeepSupplement=wa;var Z=C.Raphael.el.attr;C.Raphael.el.attr=function(){if(arguments.length==1&&(typeof arguments[0]==="string"||typeof arguments[0]==="array")||typeof this.joints==="undefined")return Z.apply(this,arguments);var c={},k;for(k in this.attrs)c[k]=this.attrs[k];Z.apply(this,arguments);var p=this.attrs;k=false;if(c.x!=p.x||c.y!=p.y||c.cx!=p.cx||c.cy!=p.cy||c.path!=p.path||c.r!=p.r)k=true;for(c=this.joints().length-1;c>=0;--c){p=this.joints()[c]; if(k){p.update();p.callback("objectMoving",p,[this])}}return this};C.Raphael.el.joint=function(c,k){s.paper(this.paper);return new s(this,c,k)};C.Raphael.el.euid=function(){return s.generateEuid.call(this)};C.Raphael.el.yourself=function(){return this};C.Raphael.el.joints=function(){return this._joints||(this._joints=[])};C.Raphael.fn.euid=function(){return s.generateEuid.call(this)}})(this);(function(C){var s=C.Joint,E=s.point,g=s.rect,i=s.dia={_currentDrag:false,_currentZoom:false,_registeredObjects:{},_registeredJoints:{},Joint:function(){var j=s.apply(null,arguments);this.registerJoint(j);return j},registeredElements:function(){return this._registeredObjects[s.paper().euid()]||(this._registeredObjects[s.paper().euid()]=[])},registeredJoints:function(){return this._registeredJoints[s.paper().euid()]||(this._registeredJoints[s.paper().euid()]=[])},register:function(j){(this._registeredObjects[s.paper().euid()]|| (this._registeredObjects[s.paper().euid()]=[])).push(j)},unregister:function(j){for(var r=this._registeredObjects[s.paper().euid()]||(this._registeredObjects[s.paper().euid()]=[]),w=r.length;w--;)r[w]===j&&r.splice(w,1)},registerJoint:function(j){(this._registeredJoints[s.paper().euid()]||(this._registeredJoints[s.paper().euid()]=[])).push(j)},unregisterJoint:function(j){for(var r=this._registeredJoints[s.paper().euid()]||(this._registeredJoints[s.paper().euid()]=[]),w=r.length;w--;)r[w]===j&&r.splice(w, 1)}};C=i.Element=function(){};C.create=function(j){var r=new this(j);r.init&&r.init(j);r.defaults(r.properties);r.paper.safari();return r};C.extend=function(j){var r=j.constructor=function(u){this.construct(u)};r.base=this;var w=r.prototype=new this;s.Mixin(w,j);s.Supplement(r,this);return r};C.prototype={parentElement:null,toolbox:null,_isElement:true,lastScaleX:1,lastScaleY:1,dx:undefined,dy:undefined,origBBox:undefined,construct:function(j){this.properties={dx:0,dy:0,rot:0,sx:1,sy:1,module:this.module, object:this.object,parent:j.parent};this.shadow=this.wrapper=null;this.shadowAttrs={stroke:"none",fill:"#999",translation:"7,7",opacity:0.5};this.inner=[];this.ghostAttrs={opacity:0.5,"stroke-dasharray":"-",stroke:"black"};this._opt={draggable:true,ghosting:false,toolbox:false};this.paper=s.paper();i.register(this)},defaults:function(j){if(j.shadow){s.Mixin(this.shadowAttrs,j.shadow);this.createShadow()}},euid:function(){return s.generateEuid.call(this)},joints:function(){return this.wrapper.joints()}, yourself:function(){return this.wrapper},updateJoints:function(){var j=this.wrapper.joints();if(j)for(var r=0,w=j.length;r<w;r++)j[r].update()},toggleGhosting:function(){this._opt.ghosting=!this._opt.ghosting;return this},createGhost:function(){this.ghost=this.cloneWrapper(this.ghostAttrs)},createShadow:function(){this.shadowAttrs.rotation=this.wrapper.attrs.rotation;this.shadow=this.cloneWrapper(this.shadowAttrs);this.shadow.toBack()},cloneWrapper:function(j){var r=this.wrapper.attrs,w=this.wrapper.paper, u;switch(this.wrapper.type){case "rect":u=w.rect(r.x,r.y,r.width,r.height,r.r);break;case "circle":u=w.circle(r.cx,r.cy,r.r);break;case "ellipse":u=w.ellipse(r.cx,r.cy,r.rx,r.ry)}u.attr(j);return u},objPos:function(j){switch(this[j].type){case "rect":return E(this[j].attr("x"),this[j].attr("y"));case "circle":case "ellipse":return E(this[j].attr("cx"),this[j].attr("cy"))}},wrapperPos:function(){return this.objPos("wrapper")},ghostPos:function(){return this.objPos("ghost")},toFront:function(){this.shadow&& this.shadow.toFront();this.wrapper&&this.wrapper.toFront();for(var j=0,r=this.inner.length;j<r;j++)this.inner[j].toFront();return this},toBack:function(){for(var j=this.inner.length-1;j>=0;--j)this.inner[j].toBack();this.wrapper&&this.wrapper.toBack();this.shadow&&this.shadow.toBack();return this},dragger:function(j){if(this.wholeShape._opt.draggable){i._currentDrag=this.wholeShape;if(i._currentDrag._opt.ghosting){i._currentDrag.createGhost();i._currentDrag.ghost.toFront()}else i._currentDrag.toFront(); i._currentDrag.removeToolbox();i._currentDrag.translate(1,1);i._currentDrag.translate(-1,-1);i._currentDrag.dx=j.clientX;i._currentDrag.dy=j.clientY;j.preventDefault&&j.preventDefault()}},zoomer:function(j){i._currentZoom=this;i._currentZoom.toFront();i._currentZoom.removeToolbox();var r=g(i._currentZoom.origBBox);i._currentZoom.dx=j.clientX;i._currentZoom.dy=j.clientY;i._currentZoom.dWidth=r.width*i._currentZoom.lastScaleX;i._currentZoom.dHeight=r.height*i._currentZoom.lastScaleY;j.preventDefault&& j.preventDefault()},translate:function(j,r){this.properties.dx+=j;this.properties.dy+=r;this.wrapper.translate(j,r);this.shadow&&this.shadow.translate(j,r);for(var w=this.inner.length-1;w>=0;--w)this.inner[w].translate(j,r);this.translateToolbox(j,r);this.paper.safari()},setWrapper:function(j){this.wrapper=j;this.wrapper.wholeShape=this;this.type=this.wrapper.type;this.origBBox=this.wrapper.getBBox();if(this._opt&&this._opt.draggable){this.wrapper.mousedown(this.dragger);this.wrapper.node.style.cursor= "move"}if(!this.wrapper.joints){this.wrapper._joints=[];this.wrapper.joints=function(){return this._joints}}this.addToolbox();return this},addInner:function(j){this.inner.push(j);j.wholeShape=this;j.parentElement=this;if(j._isElement)j.properties.parent=this.euid();if(!j._isElement&&this._opt&&this._opt.draggable){j.mousedown(this.dragger);j.node.style.cursor="move"}j.toFront();return this},delInner:function(j){for(var r=0,w=this.inner.length;r<w;r++)if(this.inner[r]==j)break;if(r<w){this.inner.splice(r, 1);j.parentElement=null;if(j._isElement)j.properties.parent=undefined}return this},addToolbox:function(){if(!this._opt.toolbox)return this;var j=this,r=this.wrapper.getBBox(),w=r.x-10;r=r.y-22;this.toolbox=[];this.toolbox.push(this.paper.rect(w,r,33,22,5).attr({fill:"white"}));this.toolbox.push(this.paper.image("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAE5SURBVHjaYvz//z8DsQAggFhARGRkpBETE1M/kGkOxIz//v078+HDh4odO3acBPJ//4eaCBBADCA6Kirq4JlzJ978/vPrNwifOHX4fUhIyFmgvDQQs4HUgDBAALFAbTDX1zNiZmFmBfONDM14WFlZdYFMCSD+AsS/QOIAAcQEVcyIw5m8IJNhHIAAAisGufHMuZNfgE74A8Knzx7/LiLO91tfXx9kOgsjEIDUAQQQ2FqQZ3q7Jk6AWs2gqCbOkZDn8l9AiLuNi4vrxfHjx7cC1X8HCCCwYqiv/aBu5NXQ0FD9+/dfr4uf/te7N1/Mu337ttmbN2/uAwQQzIO/gfg11DNsN4BA/LD4n8f33swF8v8DFQoAaS6AAGLEFilQN3JCbQLhH0B8HyCAGHHFIFQDB1QTSNEXgAADAEQ2gYZ9CcycAAAAAElFTkSuQmCC", w,r,11,11));this.toolbox[this.toolbox.length-1].toFront();s.addEvent(this.toolbox[this.toolbox.length-1].node,"mousedown",function(u){i.Element.prototype.zoomer.apply(j,[u])});this.toolbox.push(this.paper.image("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAEJSURBVHjaYvj//z8DFGOAnz9/rjl27Jg0AwMDExAzAAQQI0ghFPz/8usZjM3ACJTnYBEC0iyfmZmZZYBCXwECiAkm+evXL4bff34w/P33C4z//PvB8O33awYmJiZeoDQ/ELMBBBALSKGJiQkPOzs7AxsbC8OaTXMZWFhZoEb8g5nFDsTMAAHEBFIIZLwCuo/hy5dvDCF+yQx/fv+BuAvhRDAACCCQM0AO5YRJfv78lSE+Ko/h79+/DP8RJoMBQACheHDv4wYGdOAs28DAyMioCmS+AAggJgYSAEAAoZiMUxHUZIAAYkES4AJSQjD3o4HvQPwXIIDgJgMVM4PCEhREWBT/BUUFQIABAMuFbgea+o0EAAAAAElFTkSuQmCC", w+22,r,11,11));this.toolbox[this.toolbox.length-1].toFront();this.toolbox[this.toolbox.length-1].node.onclick=function(){j.embed()};this.toolbox.push(this.paper.image("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAEJSURBVHjaYvj//z8DFGOAnz9/rjl27Jg0AwMDExAzAAQQI0ghFPz/8usZjM3ACJTnYBEC0iyfmZmZZYBCXwECiIkBCfz99wuO//z7wfDt92sGJiYmXqAUPxCzAQQQi4mJyX0gQwFZExcXJ8OaTXMYODmZYULsQMwMEEAgk9WB+D0jIyNElJ2NYdXG2QzsHOwMSE4EA4AAYjpz5swvIC3By8sLVrh2yzygiRwQTzD8Q1EMEEBwD/779+//7gcNDCysKN5gcJZtYADaqgpkvgAIILgM0CMYCtEBQAChBB1ORVCTAQKIBUmAC0gJATEnFvXfQSELEEBwk4GKQeHEBgoiLIr/AvEvgAADAH4mYO9cg5S2AAAAAElFTkSuQmCC", w+11,r,11,11));this.toolbox[this.toolbox.length-1].toFront();this.toolbox[this.toolbox.length-1].node.onclick=function(){j.unembed()};this.toolbox.push(this.paper.path("M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248").attr({fill:"#000",stroke:"none"}).translate(w,r).scale(0.5));this.toolbox[this.toolbox.length-1].toFront();this.toolbox[this.toolbox.length-1].node.onclick=function(){j.remove()}; this.toolbox.push(this.paper.image("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAEjSURBVHjaYvz//z8DsQAggJjwSaanpwsBMReMDxBATAQMO/zv379eRkZGdiBmAgggJiymqaWlpS0GSrIAFZ4A0h5AYR4gZgEIICaoAg6ggolACea/f/9aAulAoDD3169fNwPZ0kA2B0gxQADBTBYECuYCaa7bt2/vACkEYs4zZ84cA9KsQAwKBUaAAGIBqfzz5w8jExPTRiCTXUFBwQ9IfwP5x8TExAJI/4IpBgggsOJ58+Y9B1JRQMwGdOdjoFP2ghRwcnL6A4P2KUghiA8QQGDFQIH/QGf8BDJ/L1myZC8fHx/IeiZmZmbr379/H4ApBgggFlgoANX/A1L/gJoYP336BHIG47Nnz1zu3r0LUvgD5FqAAGLEF4Og0EHy4G+AAAMAho1gqqugDLgAAAAASUVORK5CYII=", w,r+11,11,11));this.toolbox[this.toolbox.length-1].toFront();this.toolbox[this.toolbox.length-1].node.onmousedown=function(){i._currentDrag=j.clone()[0];console.log(i._currentDrag[0])};return this},removeToolbox:function(){if(this.toolbox)for(var j=this.toolbox.length-1;j>=0;--j)this.toolbox[j].remove();this.toolbox=null;return this},toggleToolbox:function(){this._opt.toolbox=!this._opt.toolbox;this._opt.toolbox?this.addToolbox():this.removeToolbox();return this},translateToolbox:function(j,r){if(this.toolbox)for(var w= this.toolbox.length-1;w>=0;--w)this.toolbox[w].translate(j,r)},disconnect:function(){for(var j=this.joints(),r=j.length,w;r--;){w=j[r];if(w.endObject().wholeShape===this){w.freeJoint(w.endObject());w.draw(["dummyEnd"]);w.update()}if(w.startObject().wholeShape===this){w.freeJoint(w.startObject());w.draw(["dummyStart"]);w.update()}}},unregisterFromJoints:function(){for(var j=this.joints(),r=j.length;r--;)j[r].unregister(this);return this},remove:function(){var j=this.inner,r=j.length;this.unregisterFromJoints(); this.disconnect();this.removeToolbox();for(this.unembed();r--;)j[r].remove();this.wrapper.remove();this.shadow&&this.shadow.remove();i.unregister(this);this.removed=true;return null},liquidate:function(){for(var j=this.joints(),r=j.length,w,u=this.inner;r--;){w=j[r];w.freeJoint(w.startObject());w.freeJoint(w.endObject());w.clean(["connection","startCap","endCap","handleStart","handleEnd","label"]);i.unregisterJoint(w);w.unregister(this)}this.removeToolbox();this.unembed();for(r=u.length;r--;)u[r].liquidate? u[r].liquidate():u[r].remove();this.wrapper.remove();this.shadow&&this.shadow.remove();i.unregister(this);this.removed=true;return null},draggable:function(j){this._opt.draggable=j;this.wrapper.node.style.cursor=j?"move":null;for(var r=this.inner.length;r--;)this.inner[r].node.style.cursor=j?"move":null;return this},highlight:function(){this.wrapper.attr("stroke","red");return this},unhighlight:function(){this.wrapper.attr("stroke",this.properties.attrs.stroke||"#000");return this},embed:function(){for(var j= i._registeredObjects[this.paper.euid()],r=g(this.wrapper.getBBox()),w=null,u=0,I=j.length;u<I;u++){var K=j[u];if(g(K.getBBox()).containsPoint(r.origin()))w=K;if(K==this.parentElement){K.delInner(this);if(w)break}}w&&w.addInner(this);return this},unembed:function(){if(this.parentElement){this.parentElement.delInner(this);this.parentElement=null;this.properties.parent=undefined}return this},scale:function(j,r){this.properties.sx=j;this.properties.sy=r;this.shadow&&this.shadow.scale.apply(this.shadow, arguments);this.wrapper.scale.apply(this.wrapper,arguments);this.zoom.apply(this,arguments);for(var w=0,u=this.inner.length;w<u;w++){var I=this.inner[w];I._isElement&&I.scale.apply(I,arguments)}if(!this._doNotRedrawToolbox){this.removeToolbox();this.addToolbox()}},zoom:function(){},getBBox:function(){return this.wrapper.getBBox()},joint:function(j,r){var w=this.wrapper.joint.apply(this.wrapper,[j._isElement?j.wrapper:j,r]);s.dia.registerJoint(w);return w},attr:function(){return Raphael.el.attr.apply(this.wrapper, arguments)}};C.mouseMove=function(j){j=j||window.event;if(i._currentDrag){i._currentDrag._opt.ghosting?i._currentDrag.ghost.translate(j.clientX-i._currentDrag.dx,j.clientY-i._currentDrag.dy):i._currentDrag.translate(j.clientX-i._currentDrag.dx,j.clientY-i._currentDrag.dy);i._currentDrag.dx=j.clientX;i._currentDrag.dy=j.clientY}if(i._currentZoom){var r=j.clientY-i._currentZoom.dy;i._currentZoom.dWidth-=j.clientX-i._currentZoom.dx;i._currentZoom.dHeight-=r;if(i._currentZoom.dWidth<1)i._currentZoom.dWidth= 1;if(i._currentZoom.dHeight<1)i._currentZoom.dHeight=1;r=i._currentZoom.dWidth/i._currentZoom.origBBox.width;var w=i._currentZoom.dHeight/i._currentZoom.origBBox.height;i._currentZoom._doNotRedrawToolbox=true;i._currentZoom.scale(r,w);i._currentZoom.paper.safari();i._currentZoom.dx=j.clientX;i._currentZoom.dy=j.clientY;i._currentZoom.lastScaleX=r;i._currentZoom.lastScaleY=w}};C.mouseUp=function(){if(i._currentDrag&&i._currentDrag._opt.ghosting){var j=i._currentDrag.ghostPos(),r=i._currentDrag.wrapperPos(); i._currentDrag.translate(j.x-r.x,j.y-r.y);i._currentDrag.ghost.remove();i._currentDrag.updateJoints()}if(i._currentDrag){i._currentDrag.addToolbox();i._currentDrag.toFront();i._currentDrag.translate(1,1);i._currentDrag.translate(-1,-1)}if(i._currentZoom){i._currentZoom.removeToolbox();i._currentZoom.addToolbox();i._currentZoom.toFront()}i._currentDrag=false;i._currentZoom=false};s.addEvent(document,"mousemove",C.mouseMove);s.addEvent(document,"mouseup",C.mouseUp)})(this);(function(C){var s=C.Joint;C=s.dia.Element;var E=s.point,g=s.dia.uml={};s.arrows.aggregation=function(){return{path:["M","7","0","L","0","5","L","-7","0","L","0","-5","z"],dx:9,dy:9,attrs:{stroke:"black","stroke-width":2,fill:"black"}}};g.aggregationArrow={endArrow:{type:"aggregation"},startArrow:{type:"none"},attrs:{"stroke-dasharray":"none"}};g.dependencyArrow={endArrow:{type:"basic",size:5},startArrow:{type:"none"},attrs:{"stroke-dasharray":"none"}};g.generalizationArrow={endArrow:{type:"basic", size:10,attrs:{fill:"white"}},startArrow:{type:"none"},attrs:{"stroke-dasharray":"none"}};g.arrow={startArrow:{type:"none"},endArrow:{type:"basic",size:5},attrs:{"stroke-dasharray":"none"}};g.State=C.extend({object:"State",module:"uml",init:function(i){i=s.DeepSupplement(this.properties,i,{radius:15,attrs:{fill:"white"},label:"",labelOffsetX:20,labelOffsetY:5,swimlaneOffsetY:18,actions:{entry:"",exit:"",inner:[]},actionsOffsetX:5,actionsOffsetY:5});this.setWrapper(this.paper.rect(i.rect.x,i.rect.y, i.rect.width,i.rect.height,i.radius).attr(i.attrs));this.addInner(this.getLabelElement());this.addInner(this.getSwimlaneElement());this.addInner(this.getActionsElement())},getLabelElement:function(){var i=this.properties,j=this.wrapper.getBBox(),r=this.paper.text(j.x,j.y,i.label).attr(i.labelAttrs||{}),w=r.getBBox();r.translate(j.x-w.x+i.labelOffsetX,j.y-w.y+i.labelOffsetY);return r},getSwimlaneElement:function(){var i=this.wrapper.getBBox(),j=this.properties;return this.paper.path(["M",i.x,i.y+j.labelOffsetY+ j.swimlaneOffsetY,"L",i.x+i.width,i.y+j.labelOffsetY+j.swimlaneOffsetY].join(" "))},getActionsElement:function(){var i=this.properties,j=i.actions.entry!=""?"entry/ "+i.actions.entry+"\n":"";j+=i.actions.exit!=""?"exit/ "+i.actions.exit+"\n":"";for(var r=i.actions.inner.length,w=0;w<r;w+=2)j+=i.actions.inner[w]+"/ "+i.actions.inner[w+1]+"\n";j=j.replace(/^\s\s*/,"").replace(/\s\s*$/,"");r=this.wrapper.getBBox();i=this.paper.text(r.x+i.actionsOffsetX,r.y+i.labelOffsetY+i.swimlaneOffsetY+i.actionsOffsetY, j);j=i.getBBox();i.attr("text-anchor","start");i.translate(0,j.height/2);return i},zoom:function(){this.wrapper.attr("r",this.properties.radius);this.shadow&&this.shadow.attr("r",this.properties.radius);this.inner[0].remove();this.inner[1].remove();this.inner[2].remove();this.inner[0]=this.getLabelElement();this.inner[1]=this.getSwimlaneElement();this.inner[2]=this.getActionsElement()}});g.StartState=C.extend({object:"StartState",module:"uml",init:function(i){i=s.DeepSupplement(this.properties,i, {position:E(0,0),radius:10,attrs:{fill:"black"}});this.setWrapper(this.paper.circle(i.position.x,i.position.y,i.radius).attr(i.attrs))}});g.EndState=C.extend({object:"EndState",module:"uml",init:function(i){i=s.DeepSupplement(this.properties,i,{position:E(0,0),radius:10,innerRadius:i.radius&&i.radius/2||5,attrs:{fill:"white"},innerAttrs:{fill:"black"}});this.setWrapper(this.paper.circle(i.position.x,i.position.y,i.radius).attr(i.attrs));this.addInner(this.paper.circle(i.position.x,i.position.y,i.innerRadius).attr(i.innerAttrs))}, zoom:function(){this.inner[0].scale.apply(this.inner[0],arguments)}});g.Class=C.extend({object:"Class",module:"uml",init:function(i){i=s.DeepSupplement(this.properties,i,{attrs:{fill:"white"},label:"",labelOffsetX:20,labelOffsetY:5,swimlane1OffsetY:18,swimlane2OffsetY:18,attributes:[],attributesOffsetX:5,attributesOffsetY:5,methods:[],methodsOffsetX:5,methodsOffsetY:5});this.setWrapper(this.paper.rect(i.rect.x,i.rect.y,i.rect.width,i.rect.height).attr(i.attrs));this.addInner(this.getLabelElement()); this.addInner(this.getSwimlane1Element());this.addInner(this.getAttributesElement());this.addInner(this.getSwimlane2Element());this.addInner(this.getMethodsElement())},getLabelElement:function(){var i=this.properties,j=this.wrapper.getBBox(),r=this.paper.text(j.x,j.y,i.label).attr(i.labelAttrs||{}),w=r.getBBox();r.translate(j.x-w.x+i.labelOffsetX,j.y-w.y+i.labelOffsetY);return r},getSwimlane1Element:function(){var i=this.wrapper.getBBox(),j=this.properties;return this.paper.path(["M",i.x,i.y+j.labelOffsetY+ j.swimlane1OffsetY,"L",i.x+i.width,i.y+j.labelOffsetY+j.swimlane1OffsetY].join(" "))},getSwimlane2Element:function(){var i=this.properties,j=this.wrapper.getBBox(),r=this.inner[2].getBBox();return this.paper.path(["M",j.x,j.y+i.labelOffsetY+i.swimlane1OffsetY+r.height+i.swimlane2OffsetY,"L",j.x+j.width,j.y+i.labelOffsetY+i.swimlane1OffsetY+r.height+i.swimlane2OffsetY].join(" "))},getAttributesElement:function(){for(var i=" ",j=this.properties,r=0,w=j.attributes.length;r<w;r++)i+=j.attributes[r]+"\n"; i=i.replace(/^\s\s*/,"").replace(/\s\s*$/,"");r=this.wrapper.getBBox();i=this.paper.text(r.x+j.attributesOffsetX,r.y+j.labelOffsetY+j.swimlane1OffsetY+j.attributesOffsetY,i);j=i.getBBox();i.attr("text-anchor","start");i.translate(0,j.height/2);return i},getMethodsElement:function(){for(var i=" ",j=this.properties,r=0,w=j.methods.length;r<w;r++)i+=j.methods[r]+"\n";i=i.replace(/^\s\s*/,"").replace(/\s\s*$/,"");r=this.wrapper.getBBox();w=this.inner[2].getBBox();i=this.paper.text(r.x+j.methodsOffsetX, r.y+j.labelOffsetY+j.swimlane1OffsetY+j.attributesOffsetY+w.height+j.swimlane2OffsetY+j.methodsOffsetY,i);j=i.getBBox();i.attr("text-anchor","start");i.translate(0,j.height/2);return i},zoom:function(){this.inner[0].remove();this.inner[1].remove();this.inner[2].remove();this.inner[3].remove();this.inner[4].remove();this.inner[0]=this.getLabelElement();this.inner[1]=this.getSwimlane1Element();this.inner[2]=this.getAttributesElement();this.inner[3]=this.getSwimlane2Element();this.inner[4]=this.getMethodsElement()}})})(this);(function(C){var s=C.Joint;C=s.dia.Element;var E=s.point,g=s.dia.fsa={};g.arrow={startArrow:{type:"none"},endArrow:{type:"basic",size:5},attrs:{"stroke-dasharray":"none"}};g.State=C.extend({object:"State",module:"fsa",init:function(i){i=s.DeepSupplement(this.properties,i,{position:E(0,0),radius:30,label:"State",labelOffsetX:15,labelOffsetY:23,attrs:{fill:"white"}});this.setWrapper(this.paper.circle(i.position.x,i.position.y,i.radius).attr(i.attrs));this.addInner(this.getLabelElement())},getLabelElement:function(){var i= this.properties,j=this.wrapper.getBBox(),r=this.paper.text(j.x,j.y,i.label),w=r.getBBox();r.translate(j.x-w.x+i.labelOffsetX,j.y-w.y+i.labelOffsetY);return r}});g.StartState=C.extend({object:"StartState",module:"fsa",init:function(i){i=s.DeepSupplement(this.properties,i,{position:E(0,0),radius:10,attrs:{fill:"black"}});this.setWrapper(this.paper.circle(i.position.x,i.position.y,i.radius).attr(i.attrs))}});g.EndState=C.extend({object:"EndState",module:"fsa",init:function(i){i=s.DeepSupplement(this.properties, i,{position:E(0,0),radius:10,innerRadius:i.radius&&i.radius/2||5,attrs:{fill:"white"},innerAttrs:{fill:"black"}});this.setWrapper(this.paper.circle(i.position.x,i.position.y,i.radius).attr(i.attrs));this.addInner(this.paper.circle(i.position.x,i.position.y,i.innerRadius).attr(i.innerAttrs))},zoom:function(){this.inner[0].scale.apply(this.inner[0],arguments)}})})(this);(function(C){var s=C.Joint;C=s.dia.Element;var E=s.dia.pn={};E.arrow={startArrow:{type:"none"},endArrow:{type:"basic",size:5},attrs:{"stroke-dasharray":"none"}};E.Place=C.extend({object:"Place",module:"pn",init:function(g){g=s.DeepSupplement(this.properties,g,{radius:20,tokenRadius:3,tokens:0,attrs:{fill:"white"},tokenAttrs:{fill:"black"}});var i=this.paper;this.setWrapper(i.circle(g.position.x,g.position.y,g.radius).attr(g.attrs));switch(g.tokens){case 0:break;case 1:this.addInner(i.circle(g.position.x, g.position.y,g.tokenRadius).attr(g.tokenAttrs));break;case 2:this.addInner(i.circle(g.position.x-g.tokenRadius*2,g.position.y,g.tokenRadius).attr(g.tokenAttrs));this.addInner(i.circle(g.position.x+g.tokenRadius*2,g.position.y,g.tokenRadius).attr(g.tokenAttrs));break;case 3:this.addInner(i.circle(g.position.x-g.tokenRadius*2-2,g.position.y,g.tokenRadius).attr(g.tokenAttrs));this.addInner(i.circle(g.position.x+g.tokenRadius*2+2,g.position.y,g.tokenRadius).attr(g.tokenAttrs));this.addInner(i.circle(g.position.x, g.position.y,g.tokenRadius).attr(g.tokenAttrs));break;default:this.addInner(i.text(g.position.x,g.position.y,g.tokens.toString()))}if(g.label){this.addInner(i.text(g.position.x,g.position.y-g.radius,g.label));this.inner[this.inner.length-1].translate(0,-this.inner[this.inner.length-1].getBBox().height)}},zoom:function(){for(var g=0,i=this.inner.length;g<i;g++)this.inner[g].scale.apply(this.inner[g],arguments);if(this.label){this.inner[this.inner.length-1].remove();g=this.wrapper.getBBox();this.inner[this.inner.length- 1]=this.paper.text(g.x,g.y,this.properties.label);this.inner[this.inner.length-1].translate(0,-this.inner[this.inner.length-1].getBBox().height)}}});E.Event=C.extend({object:"Event",module:"pn",init:function(g){g=s.DeepSupplement(this.properties,g,{attrs:{fill:"black",stroke:"black"}});var i=this.paper;this.setWrapper(i.rect(g.rect.x,g.rect.y,g.rect.width,g.rect.height).attr(g.attrs));if(g.label){this.addInner(i.text(g.rect.x,g.rect.y,g.label));this.inner[0].translate(0,-this.inner[0].getBBox().height)}}, zoom:function(){if(this.properties.label){this.inner[0].remove();var g=this.wrapper.getBBox();this.inner[0]=this.paper.text(g.x,g.y,this.properties.label);this.inner[0].translate(0,-this.inner[0].getBBox().height)}}})})(this);(function(C){var s=C.Joint;C=s.dia.Element;var E=s.dia.devs={};E.arrow={endArrow:{type:"none"},startArrow:{type:"none"},attrs:{"stroke-dasharray":"none"}};E.Model=C.extend({object:"Model",module:"devs",init:function(g){g=s.DeepSupplement(this.properties,g,{labelOffsetX:20,labelOffsetY:5,portsOffsetX:5,portsOffsetY:20,iPortRadius:5,oPortRadius:5,iPortAttrs:{fill:"green",stroke:"black"},oPortAttrs:{fill:"red",stroke:"black"},iPortLabelOffsetX:-10,iPortLabelOffsetY:-10,oPortLabelOffsetX:10,oPortLabelOffsetY:-10, iPorts:[],oPorts:[]});var i;this.setWrapper(this.paper.rect(g.rect.x,g.rect.y,g.rect.width,g.rect.height).attr(g.attrs));this.addInner(this.getLabelElement());i=0;for(l=g.iPorts.length;i<l;i++)this.addInner(this.getPortElement("i",i+1,g.iPorts[i]));i=0;for(l=g.oPorts.length;i<l;i++)this.addInner(this.getPortElement("o",i+1,g.oPorts[i]));g.iPorts=g.oPorts=g.portsOffsetX=g.portsOffsetY=g.iPortRadius=g.oPortRadius=g.iPortAttrs=g.oPortAttrs=g.iPortLabelOffsetX=g.iPortLabelOffsetY=g.oPortLabelOffsetX= g.oPortLabelOffsetY=undefined},getLabelElement:function(){var g=this.properties,i=this.wrapper.getBBox(),j=this.paper.text(i.x,i.y,g.label).attr(g.labelAttrs||{}),r=j.getBBox();j.translate(i.x-r.x+g.labelOffsetX,i.y-r.y+g.labelOffsetY);return j},getPortElement:function(g,i,j){var r=this.wrapper.getBBox(),w=this.properties;return E.Port.create({label:j,type:g,position:{x:r.x+(g==="o"?r.width:0),y:r.y+w.portsOffsetY*i},radius:w[g+"PortRadius"],attrs:w[g+"PortAttrs"],offsetX:w[g+"PortLabelOffsetX"], offsetY:w[g+"PortLabelOffsetY"]})},port:function(g,i){for(var j,r=0,w=this.inner.length;r<w;r++){j=this.inner[r];if(j.properties&&i==j.properties.label&&g==j.properties.type)return j}},joint:function(g,i,j,r){if(i.port)return this.port("o",g).joint(i.port("i",j),r)},zoom:function(){}});E.Port=C.extend({object:"Port",module:"devs",init:function(g){g=s.DeepSupplement(this.properties,g,{label:"",offsetX:0,offsetY:0,type:"i"});this.setWrapper(this.paper.circle(g.position.x,g.position.y,g.radius).attr(g.attrs)); this.addInner(this.getLabelElement())},getLabelElement:function(){var g=this.wrapper.getBBox(),i=this.properties,j=this.paper.text(g.x,g.y,i.label),r=j.getBBox();j.translate(g.x-r.x+i.offsetX,g.y-r.y+i.offsetY);return j},zoom:function(){}})})(this);(function(C){var s=C.Joint;C=s.dia.Element;var E=s.dia.cdm={};s.arrows.crowfoot=function(g){g=g||2;return{path:["M",(4*g).toString(),4*g.toString(),"L",(-4*g).toString(),"0","L",(4*g).toString(),"0","M",(-4*g).toString(),"0","L",(4*g).toString(),(-g*4).toString()],dx:4*g,dy:4*g,attrs:{stroke:"#800040",fill:"none","stroke-width":1}}};s.arrows.crowfootdashed=function(g){g=g||2;return{path:["M",(4*g).toString(),4*g.toString(),"L",(-4*g).toString(),"0","L",(g/4).toString(),"0","M",(2*g).toString(),"0", "L",(4*g).toString(),"0","M",(-4*g).toString(),"0","L",(4*g).toString(),(-g*4).toString()],dx:4*g,dy:4*g,attrs:{stroke:"#800040",fill:"white","stroke-width":1}}};E.oneToMany={endArrow:{type:"crowfoot"},startArrow:{type:"none"},attrs:{"stroke-dasharray":"none",stroke:"#800040"}};E.manyToOne={startArrow:{type:"crowfoot"},endArrow:{type:"none"},attrs:{"stroke-dasharray":"none",stroke:"#800040"}};E.manyToMany={startArrow:{type:"crowfoot"},endArrow:{type:"crowfoot"},attrs:{"stroke-dasharray":"none",stroke:"#800040"}}; E.plain={startArrow:{type:"none"},endArrow:{type:"none"},attrs:{"stroke-dasharray":"none",stroke:"#800040"}};E.arrow={startArrow:{type:"none"},endArrow:{type:"basic",size:5,attrs:{fill:"#800040",stroke:"#800040"}},attrs:{"stroke-dasharray":"none",stroke:"#800040"}};E.oneToManyDashes={endArrow:{type:"crowfootdashed"},startArrow:{type:"none"},attrs:{"stroke-dasharray":"--",stroke:"#800040"}};E.manyToOneDashes={startArrow:{type:"crowfootdashed"},endArrow:{type:"none"},attrs:{"stroke-dasharray":"--", stroke:"#800040"}};E.manyToManyDashes={startArrow:{type:"crowfoot"},endArrow:{type:"crowfoot"},attrs:{"stroke-dasharray":"-- ",stroke:"#800040"}};E.exampleArrow={startArrow:{type:"crowfoot"},endArrow:{type:"crowfootdashed"},attrs:{"stroke-dasharray":"--",stroke:"#800040"},subConnectionAttrs:[{from:1.1,to:0.5,"stroke-dasharray":"none",stroke:"#800040"}],label:["many","many"],labelAttrs:[{position:20,offset:-10},{position:-20,offset:-10}]};E.dashes={startArrow:{type:"none"},endArrow:{type:"none"},attrs:{"stroke-dasharray":"--", stroke:"#800040"}};E.Entity=C.extend({object:"Entity",module:"cdm",init:function(g){g=s.DeepSupplement(this.properties,g,{radius:10,attrs:{fill:"white"},label:"",labelOffsetX:20,labelOffsetY:5,actions:{entry:null,exit:null,inner:[]},attributesOffsetX:5,attributesOffsetY:5});this.setWrapper(this.paper.rect(g.rect.x,g.rect.y,g.rect.width,g.rect.height,g.radius).attr(g.attrs));this.addInner(this.getLabelElement());this.addInner(this.getAttributesElement())},getLabelElement:function(){var g=this.properties, i=this.wrapper.getBBox(),j=this.paper.text(i.x,i.y,g.label).attr(g.labelAttrs||{}),r=j.getBBox();j.translate(i.x-r.x+g.labelOffsetX,i.y-r.y+g.labelOffsetY);return j},getAttributesElement:function(){var g=this.properties,i=g.actions.entry?"entry/ "+g.actions.entry+"\n":"";i+=g.actions.exit?"exit/ "+g.actions.exit+"\n":"";for(var j=g.actions.inner.length,r=0;r<j;r+=2)i+=g.actions.inner[r]+"/ "+g.actions.inner[r+1]+"\n";i=i.replace(/^\s\s*/,"").replace(/\s\s*$/,"");j=this.wrapper.getBBox();g=this.paper.text(j.x+ g.attributesOffsetX,j.y+g.labelOffsetY+g.attributesOffsetY,i);i=g.getBBox();g.attr("text-anchor","start");g.translate(0,i.height/2);return g},zoom:function(){this.wrapper.attr("r",this.properties.radius);this.shadow&&this.shadow.attr("r",this.properties.radius);this.inner[0].remove();this.inner[1].remove();this.inner[0]=this.getLabelElement();this.inner[1]=this.getAttributesElement()}})})(this);(function(C){var s=C.Joint;C=s.dia.Element;var E=s.dia.erd={};E.arrow={startArrow:{type:"none"},endArrow:{type:"none"},attrs:{"stroke-dasharray":"none"}};E.toMany={startArrow:{type:"none"},endArrow:{type:"none"},attrs:{"stroke-dasharray":"none"},label:"n",labelAttrs:{position:-10,offset:-10}};E.manyTo={startArrow:{type:"none"},endArrow:{type:"none"},attrs:{"stroke-dasharray":"none"},label:"n",labelAttrs:{position:10,offset:-10}};E.toOne={startArrow:{type:"none"},endArrow:{type:"none"},attrs:{"stroke-dasharray":"none"}, label:"1",labelAttrs:{position:-10,offset:-10}};E.oneTo={startArrow:{type:"none"},endArrow:{type:"none"},attrs:{"stroke-dasharray":"none"},label:"1",labelAttrs:{position:10,offset:-10}};E.oneToMany={startArrow:{type:"none"},endArrow:{type:"none"},attrs:{"stroke-dasharray":"none"},label:["1","n"],labelAttrs:[{position:10,offset:-10},{position:-10,offset:-10}]};E.manyToOne={startArrow:{type:"none"},endArrow:{type:"none"},attrs:{"stroke-dasharray":"none"},label:["n","1"],labelAttrs:[{position:10,offset:-10}, {position:-10,offset:-10}]};E.Entity=C.extend({object:"Entity",module:"erd",init:function(g){g=s.DeepSupplement(this.properties,g,{attrs:{fill:"lightgreen",stroke:"#008e09","stroke-width":2},label:"",labelAttrs:{"font-weight":"bold"},labelOffsetX:0,labelOffsetY:0,shadow:true,weak:false,padding:5});this.setWrapper(this.paper.rect(g.rect.x,g.rect.y,g.rect.width,g.rect.height).attr(g.attrs));g.weak&&this.addInner(this.paper.rect(g.rect.x+g.padding,g.rect.y+g.padding,g.rect.width-2*g.padding,g.rect.height- 2*g.padding).attr(g.attrs));this.addInner(this.getLabelElement())},getLabelElement:function(){var g=this.properties,i=this.wrapper.getBBox(),j=this.paper.text(i.x+i.width/2,i.y+i.height/2,g.label).attr(g.labelAttrs||{}),r=j.getBBox();j.translate(i.x-r.x+g.labelOffsetX,i.y-r.y+g.labelOffsetY);return j}});E.Relationship=C.extend({object:"Relationship",module:"erd",init:function(g){g=s.DeepSupplement(this.properties,g,{attrs:{rotation:45,fill:"lightblue",stroke:"#000d5b","stroke-width":2},label:"",labelOffsetX:0, labelOffsetY:0,labelAttrs:{"font-weight":"bold"}});this.setWrapper(this.paper.rect(g.rect.x,g.rect.y,g.rect.width,g.rect.height).attr(g.attrs));this.addInner(this.getLabelElement())},getLabelElement:function(){var g=this.properties,i=this.wrapper.getBBox(),j=this.paper.text(i.x+i.width/2,i.y+i.height/2,g.label).attr(g.labelAttrs||{}),r=j.getBBox();j.translate(i.x-r.x+g.labelOffsetX,i.y-r.y+g.labelOffsetY);return j}});E.Attribute=C.extend({object:"Attribute",module:"erd",init:function(g){g=s.DeepSupplement(this.properties, g,{attrs:{fill:"red",opacity:g.primaryKey?0.8:0.5,stroke:"#5b0001","stroke-width":2,"stroke-dasharray":g.derived?".":"none"},label:"",labelAttrs:{"font-weight":"bold"},labelOffsetX:0,labelOffsetY:0,multivalued:false,derived:false,padding:5});this.setWrapper(this.paper.ellipse(g.ellipse.x,g.ellipse.y,g.ellipse.rx,g.ellipse.ry).attr(g.attrs));g.multivalued&&this.addInner(this.paper.ellipse(g.ellipse.x,g.ellipse.y,g.ellipse.rx-g.padding,g.ellipse.ry-g.padding).attr(g.attrs));this.addInner(this.getLabelElement())}, getLabelElement:function(){var g=this.properties,i=this.wrapper.getBBox(),j=this.paper.text(i.x+i.width/2,i.y+i.height/2,g.label).attr(g.labelAttrs||{}),r=j.getBBox();j.translate(i.x-r.x+g.labelOffsetX,i.y-r.y+g.labelOffsetY);return j}})})(this);(function(C){var s=C.Joint;C=s.dia.Element;var E=s.dia.org={};E.arrow={startArrow:{type:"none"},endArrow:{type:"none"},attrs:{"stroke-dasharray":"none","stroke-width":2,stroke:"gray"}};E.Member=C.extend({object:"Member",module:"org",init:function(g){g=s.DeepSupplement(this.properties,g,{attrs:{fill:"lightgreen",stroke:"#008e09","stroke-width":2},name:"",position:"",nameAttrs:{"font-weight":"bold"},positionAttrs:{},swimlaneAttrs:{"stroke-width":1,stroke:"black"},labelOffsetY:10,radius:10,shadow:true, avatar:"",padding:5});this.setWrapper(this.paper.rect(g.rect.x,g.rect.y,g.rect.width,g.rect.height,g.radius).attr(g.attrs));if(g.avatar){this.addInner(this.paper.image(g.avatar,g.rect.x+g.padding,g.rect.y+g.padding,g.rect.height-2*g.padding,g.rect.height-2*g.padding));g.labelOffsetX=g.rect.height}if(g.position){g=this.getPositionElement();this.addInner(g[0]);this.addInner(g[1])}this.addInner(this.getNameElement())},getPositionElement:function(){var g=this.properties,i=this.wrapper.getBBox(),j=this.paper.text(i.x+ i.width/2,i.y+i.height/2,g.position).attr(g.positionAttrs||{}),r=j.getBBox();j.translate(i.x-r.x+g.labelOffsetX,i.y-r.y+r.height);r=j.getBBox();g=this.paper.path(["M",r.x,r.y+r.height+g.padding,"L",r.x+r.width,r.y+r.height+g.padding].join(" "));return[j,g]},getNameElement:function(){var g=this.properties,i=this.wrapper.getBBox(),j=this.paper.text(i.x+i.width/2,i.y+i.height/2,g.name).attr(g.nameAttrs||{}),r=j.getBBox();j.translate(i.x-r.x+g.labelOffsetX,i.y-r.y+r.height*2+g.labelOffsetY);return j}})})(this);(function(C){C=C.Joint.arrows;C.hand=function(s){s=s?1+0.1*s:1;return{path:["M","-15.681352","-5.1927657","C","-15.208304","-5.2925912","-14.311293","-5.5561164","-13.687993","-5.7783788","C","-13.06469","-6.0006406","-12.343434","-6.2537623","-12.085196","-6.3408738","C","-10.972026","-6.7163768","-7.6682017","-8.1305627","-5.9385615","-8.9719142","C","-4.9071402","-9.4736293","-3.9010109","-9.8815423","-3.7027167","-9.8783923","C","-3.5044204","-9.8752373","-2.6780248","-9.5023173","-1.8662751", "-9.0496708","C","-0.49317056","-8.2840047","-0.31169266","-8.2208528","0.73932854","-8.142924","L","1.8690327","-8.0591623","L","2.039166","-7.4474021","C","2.1327395","-7.1109323","2.1514594","-6.8205328","2.0807586","-6.8020721","C","2.010064","-6.783614","1.3825264","-6.7940997","0.68622374","-6.8253794","C","-0.66190616","-6.8859445","-1.1814444","-6.8071497","-1.0407498","-6.5634547","C","-0.99301966","-6.4807831","-0.58251196","-6.4431792","-0.12850911","-6.4798929","C","1.2241412","-6.5892761", "4.7877672","-6.1187783","8.420785","-5.3511477","C","14.547755","-4.056566","16.233479","-2.9820024","15.666933","-0.73209438","C","15.450654","0.12678873","14.920327","0.61899573","14.057658","0.76150753","C","13.507869","0.85232533","12.818867","0.71394493","9.8149232","-0.090643373","C","7.4172698","-0.73284018","6.1067424","-1.0191399","5.8609814","-0.95442248","C","5.6587992","-0.90118658","4.8309652","-0.89582008","4.0213424","-0.94250688","C","3.0856752","-0.99645868","2.5291546","-0.95219288", "2.4940055","-0.82101488","C","2.4635907","-0.70750508","2.4568664","-0.61069078","2.4790596","-0.60585818","C","2.5012534","-0.60103228","2.9422761","-0.59725718","3.4591019","-0.59747878","C","3.9759261","-0.59770008","4.4500472","-0.58505968","4.512693","-0.56939128","C","4.7453841","-0.51117988","4.6195024","0.92436343","4.318067","1.650062","C","3.8772746","2.7112738","2.9836566","3.9064107","2.2797382","4.3761637","C","1.5987482","4.8306065","1.52359","4.9484512","1.8576616","5.0379653","C", "1.9860795","5.0723748","2.2155555","4.9678227","2.3676284","4.8056312","C","2.6253563","4.5307504","2.6497332","4.5328675","2.7268401","4.8368824","C","2.8605098","5.3638848","2.3264901","6.4808604","1.6782299","7.0301956","C","1.3498639","7.30845","0.75844624","8.0404548","0.36396655","8.6568609","C","-0.58027706","10.132325","-0.69217806","10.238528","-1.4487256","10.377186","C","-2.2048498","10.515767","-4.6836995","9.9021604","-6.41268","9.1484214","C","-9.9464649","7.6078865","-10.697587","7.3186028", "-12.142194","6.9417312","C","-13.020384","6.712621","-14.184145","6.4654454","-14.72833","6.3924328","C","-15.272516","6.3194263","-15.731691","6.241583","-15.748724","6.2194535","C","-15.813855","6.1348086","-16.609132","-4.7586323","-16.562804","-4.9315285","C","-16.551052","-4.9753876","-16.154402","-5.0929474","-15.681351","-5.192769","L","-15.681352","-5.1927657","z","M","11.288619","-1.446424","L","10.957631","-0.2111606","L","11.627189","-0.031753373","C","13.374637","0.43647423","14.580622", "0.18262123","15.042031","-0.75056578","C","15.503958","-1.6847955","14.648263","-2.6070187","12.514834","-3.4742549","L","11.634779","-3.8320046","L","11.627191","-3.2568392","C","11.623019","-2.9405087","11.470661","-2.1258178","11.288619","-1.446424","z"],dx:s*17,dy:s*17,attrs:{scale:s,fill:"white"}}};C.flower=function(s){s=s?1+0.1*s:1;return{path:["M","14.407634","0.14101164","C","13.49394","-0.67828198","12.640683","-1.3981484","11.695412","-1.9684748","C","9.0580339","-3.5615387","6.1975385", "-4.0965167","3.8809003","-3.2050972","C","-1.0202735","-1.4355585","-2.2650956","-0.75266958","-6.1678175","-0.75266958","L","-6.1678175","-2.0100414","C","-1.8745566","-2.0888183","1.0024122","-3.7090503","1.8649218","-6.1147565","C","2.2734082","-7.1733737","2.0690534","-8.5444386","0.7737959","-9.8037723","C","-0.82956951","-11.36162","-5.2455289","-11.821547","-6.0950803","-7.2474282","C","-5.3751604","-7.7316963","-3.8041596","-7.6860056","-3.2477662","-6.7174716","C","-2.8775009","-5.9772878", "-3.0228781","-5.1443269","-3.3412911","-4.7534348","C","-3.7218578","-4.1236184","-4.935379","-3.5168459","-6.1678175","-3.5168459","L","-6.1678175","-5.6886834","L","-8.5890734","-5.6886834","L","-8.5890734","-1.1787104","C","-9.8368017","-1.2379009","-10.838424","-1.918296","-11.394817","-3.1843135","C","-11.92063","-3.0214395","-12.984452","-2.2582108","-12.911997","-1.2099015","C","-14.045721","-1.0028338","-14.687381","-0.80225028","-15.717737","0.14101164","C","-14.687714","1.0836088","-14.046053", "1.2744822","-12.911997","1.4815506","C","-12.984786","2.5298263","-11.92063","3.2930879","-11.394817","3.4559626","C","-10.838424","2.1902771","-9.8368017","1.5095164","-8.5890734","1.4503588","L","-8.5890734","5.9603315","L","-6.1678175","5.9603315","L","-6.1678175","3.788495","C","-4.935379","3.788495","-3.7218578","4.3958989","-3.3412911","5.0250837","C","-3.0228781","5.4159757","-2.8775009","6.2482381","-3.2477662","6.9891209","C","-3.8041596","7.9569902","-5.3751604","8.003345","-6.0950803", "7.5190778","C","-5.2455353","12.093197","-0.82956631","11.643978","0.7737959","10.08583","C","2.0693864","8.827128","2.2734082","7.4453226","1.8649218","6.3864056","C","1.00208","3.980998","-1.8745566","2.3705098","-6.1678175","2.2920986","L","-6.1678175","1.0243179","C","-2.2650956","1.0243179","-1.0206064","1.7065088","3.8809003","3.4767455","C","6.1975385","4.367168","9.0580339","3.8331873","11.695412","2.2401238","C","12.640683","1.669431","13.493608","0.95964074","14.407634","0.14101164","z"], dx:s*15,dy:s*15,attrs:{scale:s,fill:"white"}}};C.rect=function(s){s||(s=5);return{path:["M",(3*s).toString(),s.toString(),"L",(-3*s).toString(),s.toString(),"L",(-3*s).toString(),(-s).toString(),"L",(3*s).toString(),(-s).toString(),"z"],dx:3*s,dy:3*s,attrs:{stroke:"black",fill:"white","stroke-width":1}}}})(this);(function(C){var s=C.Joint;s.Mixin(s.prototype,{compact:function(){var E=this.startObject(),g=this.endObject(),i=this._registeredObjects,j=i.length,r={object:"joint",euid:this.euid(),opt:this._opt,from:undefined,to:undefined,registered:{start:[],end:[],both:[]}};if(E.wholeShape)r.from=E.wholeShape.euid();if(g.wholeShape)r.to=g.wholeShape.euid();if(this.isStartDummy())r.from=E.attrs.cx+"@"+E.attrs.cy;if(this.isEndDummy())r.to=g.attrs.cx+"@"+g.attrs.cy;for(;j--;){E=i[j];r.registered[E._capToStick|| "both"].push(E.euid())}return r},stringify:function(){return JSON.stringify(this.compact())}});s.Mixin(s.dia,{clone:function(){return this.parse(this.stringify(s.paper()))},parse:function(E){E=JSON.parse(E);var g,i,j,r=[],w,u,I={},K=[];E instanceof Array||(E=[E]);w=0;for(u=E.length;w<u;w++){g=E[w];i=g.module;j=g.object;if(j==="joint"){r.push(g);K.push(g)}else{if(this[i])if(this[i][j])i=this[i][j].create(g);else{console.error("Object "+j+" of module "+i+" is missing.");return}else{console.error("Module "+ i+" is missing.");return}if(g.euid)I[g.euid]=i;i.translate(g.dx,g.dy);i.scale(g.sx,g.sy);K.push(i)}}this.hierarchize(I);this.createJoints(r,I);return K},hierarchize:function(E){var g,i;for(g in E)if(E.hasOwnProperty(g)){i=E[g];i.properties.parent&&E[i.properties.parent]&&E[i.properties.parent].addInner(i)}},createJoints:function(E,g){for(var i=E.length,j,r,w,u,I,K,Q=["start","end","both"],Y=Q.length;i--;){j=E[i];r=g[j.from];w=g[j.to];r=r?r.wrapper:{x:j.from.split("@")[0],y:j.from.split("@")[1]};w= w?w.wrapper:{x:j.to.split("@")[0],y:j.to.split("@")[1]};w=this.Joint(r,w,j.opt);r=[];for(Y=Q.length;Y--;){K=Q[Y];for(I=j.registered[K].length;I--;)if(g[j.registered[K][I]]){u=g[j.registered[K][I]];u._capToStick=K;r.push(u)}}w.registerForever(r)}},stringify:function(E){var g,i,j,r=[];g=this._registeredObjects;var w=this._registeredJoints;E=E.euid();if(g[E]){g=g[E];for(i=g.length;i--;){j=g[i];j.object&&r.push(j.stringify())}}if(w[E]){g=w[E];for(i=g.length;i--;){j=g[i];r.push(j.stringify())}}return"["+ r.join(",")+"]"}});s.Mixin(s.dia.Element.prototype,{stringify:function(){return JSON.stringify(s.Mixin(this.properties,{euid:this.euid()}))},clone:function(){return s.dia.parse(this.stringify())[0]}})})(this);
